<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>2025 ISC ëŒ€ë§Œ ì—¬í–‰</title>

  <!-- âœ… [1] í°íŠ¸ CDN ì¶”ê°€ (Pretendard) -->
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

  <!-- í”„ë¦¬ë¯¸ì—„ í…Œë§ˆ CSS -->
  <style>
    /* =========================================================
       [1] CSS ë³€ìˆ˜ & ì´ˆê¸°í™” (Premium Palette)
    ========================================================= */
    :root {
      --primary-color: #1a233a; 
      --accent-color: #c5a059;  
      --bg-main: #f5f7fa;        
      --card-bg: #ffffff;
      --text-main: #2d3748;
      --text-sub: #718096;
      --border-light: #edf2f7;
      --sheet-radius: 24px;
      --safe-bottom: env(safe-area-inset-bottom, 20px);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent; 
      /* âœ… í°íŠ¸ ì ìš© */
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    html, body {
      margin: 0;
      padding: 0;
      background-color: var(--primary-color);
      color: var(--text-main);
      overscroll-behavior: none; 
      /* âœ… ëª¨ë°”ì¼ ê½‰ ì±„ìš°ê¸° í•µì‹¬ ì„¤ì • */
      width: 100%;
      height: 100%;
      overflow: hidden; /* ì´ì¤‘ ìŠ¤í¬ë¡¤ ë°©ì§€ */
    }

    /* =========================================================
       [2] ìŠ¤í”Œë˜ì‹œ & ë¡œê·¸ì¸
    ========================================================= */
    /* ìŠ¤í”Œë˜ì‹œ ìŠ¤íƒ€ì¼ì€ ìœ ì§€í•˜ë˜ ë¡œì§ì—ì„œë§Œ ì œê±° */
    .mobile-splash {
      position: fixed; inset: 0; z-index: 9999;
      background: var(--primary-color);
      display: flex; align-items: center; justify-content: center;
    }
    .mobile-splash img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }

    .login-hero {
      width: 100%;
      /* âœ… ëª¨ë°”ì¼ ì£¼ì†Œì°½ ëŒ€ì‘ ë†’ì´ ì„¤ì • */
      height: 100vh;
      height: 100dvh; 
      background: url('assets/images/taiwan.jpg') center/cover no-repeat;
      /* âœ… ë°°ê²½ ê³ ì • (ìŠ¤í¬ë¡¤ ì‹œ í”ë“¤ë¦¼ ë°©ì§€) */
      position: fixed;
      top: 0; left: 0;
      z-index: 2000;
    }
    .hero-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(135deg, rgba(26,35,58,0.85) 0%, rgba(0,0,0,0.6) 100%);
      display: flex; align-items: center; justify-content: center;
      padding: 20px;
    }
    .login-box {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 40px 24px;
      border-radius: 20px;
      width: 100%;
      max-width: 380px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    
    /* ğŸ”¥ [ìˆ˜ì •] ë¡œê·¸ì¸ í™”ë©´ ë¡œê³  ìŠ¤íƒ€ì¼: ë¹„ìœ¨ ìœ ì§€ */
    .hero-logo { 
        width: 140px;       /* ì ì ˆí•œ ê°€ë¡œ í¬ê¸° ì„¤ì • */
        height: auto;       /* ë†’ì´ëŠ” ìë™ */
        object-fit: contain;/* ë¹„ìœ¨ ìœ ì§€í•˜ë©° í‘œì‹œ */
        margin-bottom: 12px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    .login-box h2 { color: var(--primary-color); margin: 0 0 5px; font-weight: 800; }
    .hero-desc { color: var(--text-sub); margin-bottom: 24px; font-size: 14px; }
    .login-box input {
      width: 100%; padding: 14px; border: 1px solid var(--border-light);
      border-radius: 12px; font-size: 16px; margin-bottom: 16px;
      text-align: center; transition: border 0.3s;
    }
    .login-box input:focus { border-color: var(--accent-color); outline: none; }
    .primary-btn {
      width: 100%; padding: 15px; border: none; border-radius: 12px;
      background: var(--primary-color); color: #fff; font-size: 16px; font-weight: 600;
      cursor: pointer; transition: background 0.3s, transform 0.1s;
    }
    .primary-btn:active { transform: scale(0.98); }
    .error { color: #e53e3e; font-size: 13px; margin-top: 12px; min-height: 18px; }

    /* =========================================================
       [3] í™ˆ í™”ë©´ (ë‹¨ì¼ í’€ìŠ¤í¬ë¦° ëŒ€ì‹œë³´ë“œ êµ¬ì¡°)
    ========================================================= */
    .main-bg { 
        width: 100%; 
        height: 100%; 
        overflow: hidden; 
    }
    
    .home-view {
      width: 100%;
      /* âœ… ëª¨ë°”ì¼ ì£¼ì†Œì°½ ëŒ€ì‘ */
      height: 100vh;
      height: 100dvh;
      background: url('assets/images/home2.jpg') center/cover no-repeat;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    
    .home-overlay {
      position: absolute; inset: 0;
      /* âœ… ì–´ë‘¡ê²Œ ê¹”ë¦° ë°°ê²½ í•„í„° ì œê±° (íˆ¬ëª…í•˜ê²Œ ì²˜ë¦¬) */
      background: transparent;
      z-index: 1;
    }

    /* ìƒë‹¨ í—¤ë” */
    .home-header {
      position: relative; z-index: 100;
      display: flex; justify-content: space-between; align-items: center;
      padding: 20px 24px;
      /* âœ… ì•„ì´í° ë…¸ì¹˜ ì˜ì—­ ëŒ€ì‘ */
      padding-top: max(20px, env(safe-area-inset-top));
    }
    
    /* ğŸ”¥ [ìˆ˜ì •] ìƒë‹¨ í—¤ë” ë¡œê³  ìŠ¤íƒ€ì¼: ë¹„ìœ¨ ìœ ì§€ ë° ì›ë³¸ ìƒ‰ìƒ ì¶œë ¥ */
    .header-logo { 
        height: 36px;       /* í—¤ë” ë†’ì´ì— ë§ì¶¤ */
        width: auto;        /* ê°€ë¡œëŠ” ë¹„ìœ¨ëŒ€ë¡œ */
        object-fit: contain;/* ì°Œê·¸ëŸ¬ì§ ë°©ì§€ */
    }
    
    /* =========================================================
       [4] ìš°ì¸¡ ìƒë‹¨ ì¹´í…Œê³ ë¦¬ (íŒì—… ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼)
    ========================================================= */
    .menu-wrapper { 
        position: relative; 
        /* âœ… ë¡œê³  ìœ ë¬´ì™€ ìƒê´€ì—†ì´ ë©”ë‰´ë¥¼ ìš°ì¸¡ ëìœ¼ë¡œ ê³ ì • */
        margin-left: auto;
    }

    .menu-btn {
      background: rgba(255,255,255,0.15); 
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3); 
      color: #fff;
      padding: 8px 16px; 
      border-radius: 20px; 
      font-weight: 600; 
      font-size: 14px;
      cursor: pointer;
      display: flex; align-items: center; gap: 6px;
      transition: all 0.2s;
      position: relative; z-index: 101; 
      /* ë°°ê²½ì´ ë°ì•„ì§ˆ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ í…ìŠ¤íŠ¸ ê·¸ë¦¼ì ì¶”ê°€ */
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }
    .menu-btn:active { background: rgba(255,255,255,0.3); }

    /* ë©”ë‰´ ì—´ë¦´ ë•Œ í™”ë©´ ì–´ë‘¡ê²Œ í•´ì£¼ëŠ” ë ˆì´ì–´ */
    .menu-dim {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 90;
      backdrop-filter: blur(3px); -webkit-backdrop-filter: blur(3px);
      opacity: 0; visibility: hidden; transition: opacity 0.3s;
    }
    body.menu-open .menu-dim { opacity: 1; visibility: visible; }

    /* ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ ë°•ìŠ¤ */
    .category-dropdown {
      position: absolute; top: calc(100% + 12px); right: 0;
      width: 250px; background: #fff; border-radius: 20px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.3);
      padding: 8px; z-index: 100;
      opacity: 0; visibility: hidden; transform: translateY(-10px);
      transition: all 0.3s cubic-bezier(0.32, 0.72, 0, 1);
      transform-origin: top right;
    }
    body.menu-open .category-dropdown {
      opacity: 1; visibility: visible; transform: translateY(0);
    }

    .dropdown-header {
      font-size: 13px; font-weight: 700; color: var(--text-sub);
      padding: 12px 14px 8px; border-bottom: 1px solid var(--border-light);
      margin-bottom: 4px;
    }

    .drop-nav button {
      width: 100%; text-align: left; background: none; border: none;
      padding: 14px; font-size: 15px; font-weight: 600; color: var(--text-main);
      border-radius: 12px; cursor: pointer; transition: background 0.2s;
      display: flex; align-items: center; gap: 12px;
    }
    .drop-nav button span { flex: 1; }
    .drop-nav button:active { background: #f8fafc; transform: scale(0.98); }

    /* =========================================================
       [5] ë©”ì¸ ì½˜í…ì¸  (í™˜ì˜ë¬¸êµ¬ & DAY ë²„íŠ¼ë“¤)
    ========================================================= */
    .home-main-content {
      position: relative; z-index: 10;
      flex: 1; 
      display: flex; flex-direction: column; justify-content: flex-end;
      padding: 0 24px 60px; 
      /* âœ… í•˜ë‹¨ ì•ˆì „ì˜ì—­ ëŒ€ì‘ */
      padding-bottom: max(60px, env(safe-area-inset-bottom));
      color: #fff;
    }
    
    .welcome-text { 
      margin-bottom: 30px; 
      /* âœ… í…ìŠ¤íŠ¸ ê°€ë…ì„±ì„ ìœ„í•´ ê·¸ë¦¼ì ê°•í™” */
      text-shadow: 0 2px 8px rgba(0,0,0,0.6); 
    }
    .welcome-text p { font-size: 18px; margin: 0; opacity: 0.95; font-weight: 500; letter-spacing: -0.5px; }
    /* âœ… í™©ìƒ‰ì—ì„œ ê¹”ë”í•˜ê³  ì„ ëª…í•œ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½, í°íŠ¸ ë‘ê»˜ ì¡°ì ˆ */
    .welcome-text strong { color: #ffffff; font-weight: 900; font-size: 20px; letter-spacing: -0.5px; }
    .welcome-text h2 { font-size: 36px; font-weight: 900; margin: 6px 0 12px; line-height: 1.2; letter-spacing: -1px; }
    .welcome-text .sub-date { display: inline-block; padding: 6px 14px; background: rgba(0,0,0,0.4); border-radius: 20px; font-size: 13px; margin-top: 10px; border: 1px solid rgba(255,255,255,0.1); text-shadow: none; font-weight: 600;}

    /* DAY 1~4 ê·¸ë¦¬ë“œ ë²„íŠ¼ */
    .day-buttons {
      display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
    }
    .day-btn {
      background: rgba(0, 0, 0, 0.4); /* í…ìŠ¤íŠ¸ ê°€ë…ì„±ì„ ìœ„í•´ ë²„íŠ¼ ë°°ê²½ì„ ì‚´ì§ë§Œ ë” ì–´ë‘¡ê²Œ */
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 20px 16px; 
      border-radius: 16px;
      color: #fff; text-align: left;
      font-size: 18px; font-weight: 800;
      transition: all 0.2s; cursor: pointer;
      display: flex; flex-direction: column; justify-content: space-between;
      min-height: 100px;
    }
    .day-btn .day-title { font-size: 13px; font-weight: 400; opacity: 0.8; margin-top: 8px; line-height: 1.4; word-break: keep-all; }
    .day-btn:active { background: rgba(0,0,0,0.6); transform: scale(0.96); }

    /* =========================================================
       [6] Bottom Sheet (Detail Page) - ğŸ”¥ í™”ë©´ ê½‰ ì±„ì›€ ìœ ì§€
    ========================================================= */
    #detailPage {
      position: fixed; inset: 0; z-index: 3000;
      display: none; 
    }
    
    /* pointer-events: none ì¶”ê°€í•˜ì—¬ íˆ¬ëª…í• ë•Œ í´ë¦­ ë°©í•´ ë°©ì§€ */
    .detail-dim {
      position: absolute; inset: 0;
      background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px);
      opacity: 0; transition: opacity 0.3s ease;
      pointer-events: none; 
    }
    
    .detail-sheet__inner {
      position: absolute; bottom: 0; left: 0; right: 0;
      
      /* âœ… ìˆ˜ì •: ë†’ì´ë¥¼ 100%ë¡œ ë³€ê²½í•˜ì—¬ í™”ë©´ ê½‰ ì±„ì›€ */
      height: 100%; 
      height: 100dvh;
      background: var(--bg-main);
      
      /* âœ… ìˆ˜ì •: ê½‰ ì°¬ í™”ë©´ì´ë¯€ë¡œ ë‘¥ê·¼ ëª¨ì„œë¦¬ ì œê±° */
      border-radius: 0;
      
      display: flex; flex-direction: column;
      transform: translateY(100%); 
      transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1);
    }

    body.detail-open .detail-dim { opacity: 1; pointer-events: auto; }
    body.detail-open .detail-sheet__inner { transform: translateY(0); }

    .detail-header {
      display: flex; justify-content: space-between; align-items: center;
      padding: 20px 24px; background: #fff;
      
      /* âœ… ìˆ˜ì •: ë…¸ì¹˜ ì˜ì—­ ëŒ€ì‘ ë° ëª¨ì„œë¦¬ ì œê±° */
      padding-top: max(20px, env(safe-area-inset-top));
      border-radius: 0; 
      
      border-bottom: 1px solid var(--border-light); flex-shrink: 0; 
    }
    .detail-title { font-size: 18px; font-weight: 700; color: var(--primary-color); }
    .detail-actions button {
      background: none; border: none; font-size: 14px; color: var(--text-sub);
      margin-left: 12px; cursor: pointer; font-weight: 600;
    }
    #detailContent {
      flex: 1; overflow-y: auto; padding: 20px 20px calc(20px + var(--safe-bottom));
      -webkit-overflow-scrolling: touch;
    }

    /* =========================================================
       [7] ìƒì„¸ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ (ì¼ì •, í™˜ìœ¨ ë“±)
    ========================================================= */
    .day-card {
      background: var(--card-bg); border-radius: 16px; padding: 20px;
      margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03);
    }
    .day-card h3 {
      margin: 0 0 10px; font-size: 18px; color: var(--primary-color);
      display: flex; align-items: baseline; gap: 8px; font-weight: 800;
    }
    .day-card h3 span { font-size: 13px; color: var(--text-sub); font-weight: 500; }
    .day-title { margin: 0 0 20px; font-weight: 600; color: var(--accent-color); font-size: 15px; }

    .timeline { border-left: 2px solid var(--border-light); margin-left: 10px; padding-left: 20px; }
    .schedule-item { position: relative; margin-bottom: 24px; }
    .schedule-item:last-child { margin-bottom: 0; }
    .timeline-dot {
      position: absolute; left: -26px; top: 0;
      width: 10px; height: 10px; border-radius: 50%;
      background: var(--accent-color); border: 2px solid #fff;
    }
    .schedule-card { display: flex; flex-direction: column; gap: 4px; }
    .schedule-time { font-size: 13px; font-weight: 700; color: var(--text-sub); }
    .schedule-title { font-size: 15px; font-weight: 600; color: var(--text-main); }
    .schedule-desc { font-size: 13px; color: var(--text-sub); margin-top: 4px; line-height: 1.4; }

    /* í™˜ìœ¨, ëŒ€ë§Œì˜ ëª¨ë“  ê²ƒ */
    .country-compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
    .country-card { background: var(--card-bg); padding: 18px 12px; border-radius: 16px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.04); }
    .country-header { display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 12px; }
    .flag-img { width: 28px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .country-card h3 { margin: 0; font-size: 15px; font-weight: 800; letter-spacing: -0.5px; color: var(--primary-color); }
    .time-box { background: var(--bg-main); padding: 12px 8px; border-radius: 12px; margin: 12px 0; }
    .time-box .time-label { display: block; font-size: 12px; font-weight: 600; color: var(--text-sub); }
    /* âœ… ëª¨ë…¸ìŠ¤í˜ì´ìŠ¤(íˆ¬ë°•í•œ í°íŠ¸) ì œê±°í•˜ê³  ê¹”ë”í•œ ë“±í­ ìˆ«ì ì ìš© */
    .time-box strong { display: block; font-size: 17px; color: var(--primary-color); margin-top: 4px; font-weight: 800; font-variant-numeric: tabular-nums; letter-spacing: 0; }
    .country-list { list-style: none; padding: 0; margin: 0; text-align: left; font-size: 13px; }
    /* âœ… ê¸€ì”¨ì²´ ê°œì„  ë° ë°ì´í„°ê°€ ì¢ì•„ë„ ë¬´ì¡°ê±´ í•œ ì¤„ë¡œ ë‚˜ì˜¤ë„ë¡ ê°•ì œ (ì¤„ë°”ê¿ˆ ë°©ì§€) */
    .country-list li { display: flex; justify-content: space-between; align-items: center; padding: 8px 2px; border-bottom: 1px solid var(--border-light); }
    .country-list li:last-child { border: none; padding-bottom: 0; }
    .country-list li span { color: var(--text-sub); font-weight: 600; font-size: 12px; white-space: nowrap; }
    .country-list li strong { font-weight: 700; color: var(--text-main); font-size: 13px; white-space: nowrap; text-align: right; letter-spacing: -0.3px; }

    .exchange-row {
      background: var(--primary-color); color: #fff; padding: 18px 20px;
      border-radius: 16px; text-align: center; margin-bottom: 16px;
      box-shadow: 0 4px 12px rgba(26,35,58,0.15);
    }
    .exchange-row strong { font-size: 18px; font-weight: 800; letter-spacing: -0.5px; }
    .fx-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center; margin-top: 16px;}
    .fx-box input {
      width: 100%; padding: 12px; border: 1px solid var(--border-light);
      border-radius: 10px; text-align: right; font-weight: 600; font-size: 16px;
    }
    .fx-eq { font-size: 20px; color: var(--text-sub); }

    /* ğŸ”¥ [ìˆ˜ì •] 2. ì„ íƒê´€ê´‘ ì‚¬ì§„í˜• ì¹´ë“œ CSS ì¶”ê°€
       (ê¸°ì¡´ .tour-card ë®ì–´ì“°ì§€ ì•Šê³  ìƒˆë¡œìš´ í´ë˜ìŠ¤ ì‚¬ìš©) 
    */
    .tour-card-photo {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      background-color: #000;
      /* ë¹„ìœ¨ ìœ ì§€ (ë†’ì´ ì§€ì •) */
      height: 220px; 
      display: flex; flex-direction: column; justify-content: flex-end;
      color: #fff;
    }
    
    .tour-card-bg {
      position: absolute; inset: 0;
      background-size: cover; background-position: center;
      transition: transform 0.4s;
    }
    .tour-card-photo:active .tour-card-bg { transform: scale(1.05); }

    .tour-card-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0.9) 100%);
    }

    .tour-info {
      position: relative; z-index: 2;
      padding: 20px;
    }

    .tour-badge {
      display: inline-block;
      background: var(--accent-color); color: #fff;
      font-size: 11px; font-weight: 700;
      padding: 4px 10px; border-radius: 100px;
      margin-bottom: 8px; text-transform: uppercase;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .tour-badge.red { background: #e53e3e; } /* ììœ ì¼ì • */

    .tour-info h3 { margin: 0 0 6px; font-size: 22px; font-weight: 800; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    .tour-desc { font-size: 13px; opacity: 0.9; margin: 0 0 14px; line-height: 1.4; }

    /* í¬í•¨/ë¶ˆí¬í•¨ ë°•ìŠ¤ (ì¹´ë“œ ë‚´ë¶€ í•˜ë‹¨) */
    .tour-meta-box {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(4px);
      border-radius: 12px;
      padding: 10px 14px;
      display: flex; justify-content: space-between; align-items: center;
      font-size: 13px;
    }
    .tour-meta-items { display: flex; gap: 8px; font-size: 12px; }
    .tour-meta-items span { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; }

    /* âœ… ì¤‘ì‹ë¹„ ìƒíƒœ ìƒ‰ìƒ CSS ì¶”ê°€ */
    .status.pending { color: #ff4d4f; font-weight: 700; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
    .status.done { color: #22c55e; font-weight: 700; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }

    .meal-status-btn {
      background: #fff; color: #1a233a; border: none;
      font-size: 12px; font-weight: 700; padding: 6px 12px; border-radius: 8px;
    }
    .meal-status-btn.done { background: #38a169; color: #fff; }

    #requestInput {
      width: 100%; height: 120px; padding: 16px; border: 1px solid var(--border-light);
      border-radius: 12px; resize: none; font-size: 15px; margin-bottom: 12px;
    }

    /* =========================================================
       [8] ë°ìŠ¤í¬íƒ‘ (PC) ëŒ€ì‘ 
    ========================================================= */
    @media (min-width: 768px) {
      .day-buttons { grid-template-columns: repeat(4, 1fr); }
      .home-main-content { max-width: 1000px; margin: 0 auto; width: 100%; }
      .home-header { max-width: 1000px; margin: 0 auto; width: 100%; }
      
      .detail-sheet__inner {
        top: 50%; left: 50%;
        transform: translate(-50%, -100%) scale(0.9); 
        bottom: auto; right: auto;
        width: 100%; max-width: 500px; height: 80vh;
        border-radius: 24px; opacity: 0;
      }
      body.detail-open .detail-sheet__inner {
        transform: translate(-50%, -50%) scale(1); opacity: 1;
      }
    }
  </style>
</head>

<body>
  
<!-- âœ… 1. ìŠ¤í”Œë˜ì‹œ HTML íƒœê·¸ëŠ” ë‚¨ê²¨ë‘ë˜ ì£¼ì„ì²˜ë¦¬í•˜ê±°ë‚˜, JSì—ì„œ ì œì–´í•˜ì§€ ì•ŠìŒ -->
<!-- <div id="mobileSplash" class="mobile-splash" style="display:none;">...</div> -->

<!-- ================= LOGIN ================= -->
<section id="loginSection" class="login-hero">
  <div class="hero-overlay">
    <div class="login-box">
      <!-- ğŸ”¥ [ìˆ˜ì •] ë‚´ì¥ ë°ì´í„° ì œê±°í•˜ê³  ë¡œì»¬ ê²½ë¡œ ë³µì› -->
      <img src="assets/images/logo.png" class="hero-logo" onerror="this.style.display='none'">
      <h2>2025 ISC Taiwan</h2>
      <p class="hero-desc">ì‚¬ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>

      <input type="text" id="employeeId" placeholder="ì‚¬ë²ˆ ì…ë ¥">
      <button class="primary-btn" onclick="login()">ë¡œê·¸ì¸</button>
      <p id="loginError" class="error"></p>
    </div>
  </div>
</section>

<!-- ================= MAIN ================= -->
<main id="mainSection" class="main-bg" style="display:none;">

  <!-- ================= HOME VIEW ================= -->
  <section id="homeView" class="home-view">
    <div class="home-overlay"></div>
    
    <!-- ë©”ë‰´ ì—´ë¦´ ë•Œ ì „ì²´ í™”ë©´ì„ ì‚´ì§ ì–´ë‘¡ê²Œ í•´ì£¼ëŠ” ë”¤ -->
    <div id="menuDim" class="menu-dim" onclick="toggleMenu()"></div>
    
    <!-- 1ï¸âƒ£ ìƒë‹¨ í—¤ë” & ë©”ë‰´ ë²„íŠ¼ -->
    <header class="home-header">
      <!-- ğŸ”¥ [ìˆ˜ì •] ì›ë³¸ ë¡œê³ ê°€ ë¬´ì¡°ê±´ 100% ë³´ì´ë„ë¡ ìˆ˜ì • (ì—ëŸ¬ ì‹œ ìˆ¨ê¹€ ì²˜ë¦¬ ë° í•„í„°ë§ ì œê±°) -->
      <img src="assets/images/logo.png" class="header-logo" alt="INCAR Logo">
      
      <!-- ìš°ì¸¡ ìƒë‹¨ ì¹´í…Œê³ ë¦¬ ë¬¶ìŒ -->
      <div class="menu-wrapper">
        <button class="menu-btn" onclick="toggleMenu()">â˜° ì¹´í…Œê³ ë¦¬</button>
        
        <!-- ë²„íŠ¼ ëˆ„ë¥´ë©´ ì•„ë˜ë¡œ ë–¨ì–´ì§€ëŠ” ë“œë¡­ë‹¤ìš´ íŒì—… ë©”ë‰´ -->
        <div id="categoryDropdown" class="category-dropdown">
          <div class="dropdown-header">ì¹´í…Œê³ ë¦¬ ë©”ë‰´</div>
          <nav class="drop-nav">
            <button onclick="openPage('taiwan')">ğŸ‡¹ğŸ‡¼ <span>ëŒ€ë§Œì˜ ëª¨ë“  ê²ƒ</span></button>
            <button onclick="openPage('exchange')">ğŸ’± <span>í™˜ìœ¨ ê³„ì‚°ê¸°</span></button>  
            <button onclick="openPage('flight')">âœˆï¸ <span>í•­ê³µí¸ ì •ë³´</span></button>
            <button onclick="openPage('myTour')">ğŸ’ <span>ë‚˜ì˜ ì„ íƒ ê´€ê´‘</span></button>
            <button onclick="openPage('dinner')">ğŸ½ <span>ë§Œì°¬ ì•ˆë‚´</span></button>
            <button onclick="openPage('request')">ğŸ“ <span>ìš”ì²­ì‚¬í•­</span></button>
            <button onclick="openPage('contact')">ğŸ“ <span>ê¸´ê¸‰ ì—°ë½ë§</span></button>
            <!-- âœ… [ìˆ˜ì •] 2. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì¶”ê°€ -->
            <button onclick="logout()" style="border-top:1px solid #eee; margin-top:4px; color:#e53e3e;">ğŸšª <span>ë¡œê·¸ì•„ì›ƒ</span></button>
          </nav>
        </div>
      </div>
    </header>

    <!-- 2ï¸âƒ£ ë©”ì¸ ì¤‘ì•™ ì˜ì—­ (í™˜ì˜ ë¬¸êµ¬ + DAY ë²„íŠ¼) -->
    <div class="home-main-content">
      <div class="welcome-text">
        <p><strong id="employeeName"></strong> ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤</p>
        <h2>ISC Taiwan<br>ì—¬ì •ì˜ ì‹œì‘</h2>
        <span class="sub-date">2026.03.11 ~ 03.14</span>
      </div>

      <div class="day-buttons">
        <button class="day-btn" onclick="openPage('day_0')">
          <span class="day-btn-header">DAY 1</span>
          <span class="day-title">ì¸ì²œ ì¶œë°œ &<br>ì‹œë‚´ í•˜ì´ë¼ì´íŠ¸</span>
        </button>
        <button class="day-btn" onclick="openPage('day_1')">
          <span class="day-btn-header">DAY 2</span>
          <span class="day-title">ì„ íƒ ê´€ê´‘ &<br>ISC ê³µì‹ ë§Œì°¬</span>
        </button>
        <button class="day-btn" onclick="openPage('day_2')">
          <span class="day-btn-header">DAY 3</span>
          <span class="day-title">ê·¼êµ ê´€ê´‘ &<br>ììœ  ì¼ì •</span>
        </button>
        <button class="day-btn" onclick="openPage('day_3')">
          <span class="day-btn-header">DAY 4</span>
          <span class="day-title">íƒ€ì´ë² ì´ ì¶œë°œ &<br>ì¸ì²œ ê·€êµ­</span>
        </button>
      </div>
    </div>
  </section>

<!-- ================= DETAIL OVERLAY ================= -->
<section id="detailPage" class="detail-sheet">
  <!-- ğŸ”¹ dim ì˜ì—­ (ì—¬ê¸°ë§Œ í™ˆìœ¼ë¡œ) -->
  <div class="detail-dim" onclick="goHome()"></div>

  <!-- ğŸ”¹ ì‹¤ì œ ì‹œíŠ¸ -->
  <div class="detail-sheet__inner" onclick="event.stopPropagation()">
      <!-- âœ… ìƒë‹¨ í—¤ë” -->
      <div class="detail-header">
        <div class="detail-title" id="detailTitle"></div>
        <div class="detail-actions">
          <button class="btn-home" onclick="goHome()">í™ˆìœ¼ë¡œ</button>
          <button class="btn-back" onclick="goBack()">ë’¤ë¡œê°€ê¸°</button>
        </div>
      </div>
    <div id="detailContent"></div>
  </div>
</section>

</main>

<script>
/* ================= ê³µí†µ ================= */
let pageHistory = [];
let employees = [];
let currentUser = null;
const ADMIN_PASSWORD = "0000";
    
/* ================= ì¹´í…Œê³ ë¦¬ ë©”ë‰´ í† ê¸€ ================= */
function toggleMenu() {
  document.body.classList.toggle('menu-open');
}

/* ================= ì„ íƒê´€ê´‘ í…œí”Œë¦¿ (ğŸ”¥ ìˆ˜ì • 2. ì‚¬ì§„ ì¹´ë“œ ë””ìì¸ ì ìš©) ================= */
/* ì´ë¯¸ì§€ ê²½ë¡œëŠ” assets/images/ í´ë”ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡ì•˜ìœ¼ë©°, ì—†ì„ ê²½ìš° Unsplash ì´ë¯¸ì§€ê°€ ëœ¨ë„ë¡ onerrorë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤. */
const myTourTemplates = [
  { 
    keyword: "í‹°ì—”ë¼ì´", 
    html: `
      <div class="tour-card-photo">
        <div class="tour-card-bg" style="background-image: url('assets/images/tour_tienlai.jpg');" onerror="this.style.backgroundImage='url(https://images.unsplash.com/photo-1596483582098-9642e12e84d4?auto=format&fit=crop&w=800&q=80)'"></div>
        <div class="tour-card-overlay"></div>
        <div class="tour-info">
          <span class="tour-badge">ì„ íƒ 1ì•ˆ</span>
          <h3>í‹°ì—”ë¼ì´ ì˜¨ì²œ íë§</h3>
          <p class="tour-desc">í‹°ì—”ë¼ì´ ì˜¨ì²œìš• & ì–‘ëª…ì‚° êµ­ë¦½ê³µì› ìë½ì˜ ìµœê³ ê¸‰ ìœ í™© ì˜¨ì²œ</p>
          <div class="tour-meta-box">
            <div class="tour-meta-items">
              <span>ğŸ« ì…ì¥ê¶Œ</span>
              <span>ğŸšŒ ì „ìš©ì°¨ëŸ‰</span>
              <span>ğŸ½ ì¤‘ì‹(ì˜¤ë¦¬)</span>
            </div>
          </div>
        </div>
      </div>` 
  },
  { 
    keyword: "ê³ ê¶ë°•ë¬¼ê´€", 
    html: `
      <div class="tour-card-photo">
        <div class="tour-card-bg" style="background-image: url('assets/images/tour_museum.jpg');" onerror="this.style.backgroundImage='url(https://images.unsplash.com/photo-1590059390231-fb264f3d47fb?auto=format&fit=crop&w=800&q=80)'"></div>
        <div class="tour-card-overlay"></div>
        <div class="tour-info">
          <span class="tour-badge">ì„ íƒ 2ì•ˆ</span>
          <h3>ê³ ê¶ë°•ë¬¼ê´€ ì—­ì‚¬ ê¸°í–‰</h3>
          <p class="tour-desc">ì¤‘êµ­ ì—­ì‚¬ì˜ ì •ìˆ˜, ëŒ€ë§Œ ê³ ê¶ë°•ë¬¼ê´€ ê´€ëŒ</p>
          <div class="tour-meta-box">
            <div class="tour-meta-items">
              <span>ğŸ« ì…ì¥ê¶Œ</span>
              <span>ğŸšŒ ì „ìš©ì°¨ëŸ‰</span>
              <span>ğŸ½ ì¤‘ì‹(ì˜¤ë¦¬)</span>
            </div>
          </div>
        </div>
      </div>` 
  },
  { 
    keyword: "ììœ ì¼ì •", 
    html: `
      <div class="tour-card-photo">
        <div class="tour-card-bg" style="background-image: url('assets/images/tour_free.jpg');" onerror="this.style.backgroundImage='url(https://images.unsplash.com/photo-1470004914212-05527e49370b?auto=format&fit=crop&w=800&q=80)'"></div>
        <div class="tour-card-overlay"></div>
        <div class="tour-info">
          <span class="tour-badge red">ì„ íƒ 3ì•ˆ</span>
          <h3>ììœ ë¡œìš´ ëŒ€ë§Œ ì—¬í–‰</h3>
          <p class="tour-desc">ììœ ì¼ì • ëŒ€ë§Œ (ì¤‘ì‹ë¹„ ì§€ê¸‰)</p>
          <div class="tour-meta-box">
             <div class="meal-check" data-tour="ììœ ì¼ì •" style="width:100%; display:flex; justify-content:space-between; align-items:center;">
                <!-- âœ… ê³ ì •ëœ í°ìƒ‰ ê¸€ì”¨ë¥¼ ì§€ìš°ê³  CSS í´ë˜ìŠ¤ë¥¼ í†µí•´ ìƒ‰ìƒ ì œì–´ -->
                <span class="status pending">ì¤‘ì‹ë¹„ ë¯¸ì§€ê¸‰</span>
                <button class="meal-status-btn" onclick="handleMealClick(this)">ì§€ê¸‰ í™•ì¸</button>
             </div>
          </div>
        </div>
      </div>` 
  }
];

/* ================= ì„ íƒê´€ê´‘ ë Œë”ë§ í•¨ìˆ˜ ================= */
function renderMyTour() {
  const selected = currentUser.myTour || [];
  const matchedCards = myTourTemplates.filter(t => selected.some(input => input.includes(t.keyword)));
  if (matchedCards.length === 0) return `<div class="card">ì„ íƒëœ ê´€ê´‘ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
  return matchedCards.map(t => t.html).join("");
}

// ğŸ”¥ ì‘ì„±í•´ì£¼ì‹  ì›ë³¸ JSON ë¡œì§ ê·¸ëŒ€ë¡œ ìœ ì§€ (ë”ì´ìƒ MOCK_DATAë¡œ ë®ì–´ì“°ì§€ ì•ŠìŒ)
// í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì§ì ‘ ì£¼ì… (íŒŒì¼ì´ ì—†ì„ ê²½ìš° ëŒ€ë¹„)
const EMBEDDED_EMPLOYEES = [
  {
    "id": "1612156",
    "name": "ë°•ìƒí˜„",
    "flight": {
      "departure": {
        "date": "2026.03.11",
        "time": "09:00",
        "from": "ì¸ì²œ",
        "to": "íƒ€ì´ë² ì´",
        "airline": "ëŒ€í•œí•­ê³µ",
        "flightNo": "KE 2021"
      },
      "return": {
        "date": "2026.03.14",
        "time": "12:25",
        "from": "íƒ€ì´ë² ì´",
        "to": "ì¸ì²œ",
        "airline": "ëŒ€í•œí•­ê³µ",
        "flightNo": "KE 2022"
      }
    },
    "myTour": [
      "í‹°ì—”ë¼ì´"
    ]
  },
  {
    "id": "1612001",
    "name": "ê¹€í•´ë¹›ë‚˜",
    "flight": {
      "departure": {
        "date": "2026.03.11",
        "time": "08:00",
        "from": "ì¸ì²œ",
        "to": "íƒ€ì´ë² ì´",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 711"
      },
      "return": {
        "date": "2026.03.14",
        "time": "11:40",
        "from": "íƒ€ì´ë² ì´",
        "to": "ì¸ì²œ",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 712"
      }
    },
    "myTour": [
      "ììœ ì¼ì •"
    ]
  },
  {
    "id": "1612163",
    "name": "ì´ì€ì§€",
    "flight": {
      "departure": {
        "date": "2026.03.11",
        "time": "08:00",
        "from": "ì¸ì²œ",
        "to": "íƒ€ì´ë² ì´",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 711"
      },
      "return": {
        "date": "2026.03.14",
        "time": "11:40",
        "from": "íƒ€ì´ë² ì´",
        "to": "ì¸ì²œ",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 712"
      }
    },
    "myTour": [
      "í‹°ì—”ë¼ì´",
      "ê³ ê¶ë°•ë¬¼ê´€",
      "ììœ ì¼ì •"
    ]
  },
  {
    "id": "1611391",
    "name": "ë‚¨ìš±í˜„",
    "flight": {
      "departure": {
        "date": "2026.03.11",
        "time": "08:00",
        "from": "ì¸ì²œ",
        "to": "íƒ€ì´ë² ì´",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 711"
      },
      "return": {
        "date": "2026.03.14",
        "time": "11:40",
        "from": "íƒ€ì´ë² ì´",
        "to": "ì¸ì²œ",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 712"
      }
    },
    "myTour": [
      "ê³ ê¶ë°•ë¬¼ê´€"
    ]
  },
  {
    "id": "1611499",
    "name": "ìµœì§„ìš°",
    "flight": {
      "departure": {
        "date": "2026.03.11",
        "time": "08:00",
        "from": "ì¸ì²œ",
        "to": "íƒ€ì´ë² ì´",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 711"
      },
      "return": {
        "date": "2026.03.14",
        "time": "11:40",
        "from": "íƒ€ì´ë² ì´",
        "to": "ì¸ì²œ",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 712"
      }
    },
    "myTour": [
      "í‹°ì—”ë¼ì´",
      "ê³ ê¶ë°•ë¬¼ê´€",
      "ììœ ì¼ì •"
    ]
  },
   {
    "id": "1612164",
    "name": "ì´ì œí›ˆ",
    "flight": {
      "departure": {
        "date": "2026.03.11",
        "time": "08:00",
        "from": "ì¸ì²œ",
        "to": "íƒ€ì´ë² ì´",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 711"
      },
      "return": {
        "date": "2026.03.14",
        "time": "11:40",
        "from": "íƒ€ì´ë² ì´",
        "to": "ì¸ì²œ",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 712"
      }
    },
    "myTour": [
      "í‹°ì—”ë¼ì´",
      "ê³ ê¶ë°•ë¬¼ê´€",
      "ììœ ì¼ì •"
    ]
  },
  {
    "id": "1611836",
    "name": "ì‹ í˜„í•˜",
    "flight": {
      "departure": {
        "date": "2026.03.11",
        "time": "08:00",
        "from": "ì¸ì²œ",
        "to": "íƒ€ì´ë² ì´",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 711"
      },
      "return": {
        "date": "2026.03.14",
        "time": "11:40",
        "from": "íƒ€ì´ë² ì´",
        "to": "ì¸ì²œ",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 712"
      }
    },
    "myTour": [
      "í‹°ì—”ë¼ì´",
      "ê³ ê¶ë°•ë¬¼ê´€",
      "ììœ ì¼ì •"
    ]
  },
  {
    "id": "1612022",
    "name": "í˜„ë³´ë¼",
    "flight": {
      "departure": {
        "date": "2026.03.11",
        "time": "08:00",
        "from": "ì¸ì²œ",
        "to": "íƒ€ì´ë² ì´",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 711"
      },
      "return": {
        "date": "2026.03.14",
        "time": "11:40",
        "from": "íƒ€ì´ë² ì´",
        "to": "ì¸ì²œ",
        "airline": "ì•„ì‹œì•„ë‚˜í•­ê³µ",
        "flightNo": "OZ 712"
      }
    },
    "myTour": [
      "í‹°ì—”ë¼ì´",
      "ê³ ê¶ë°•ë¬¼ê´€",
      "ììœ ì¼ì •"
    ]
  }
];

// ë¡œì»¬ íŒŒì¼ ì‹œë„ í›„ ì‹¤íŒ¨í•˜ë©´ ìœ„ ë°ì´í„° ì‚¬ìš©
fetch("people/employees.json?ts=" + Date.now())
  .then(res => res.json())
  .then(data => {
    employees = data;
    tryAutoLogin(); 
  })
  .catch(err => {
    console.warn("ë¡œì»¬ JSON ë¡œë“œ ì‹¤íŒ¨, ë‚´ì¥ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.");
    employees = EMBEDDED_EMPLOYEES;
    tryAutoLogin();
  });

/* ================= ì¤‘ì‹ë¹„ ì§€ê¸‰ ë¡œì§ ================= */
function handleMealClick(btn) {
  const wrap = btn.closest(".meal-check");
  const tour = wrap.dataset.tour;
  const isDone = wrap.classList.contains("done");
  if (isDone) showMealDetail(wrap);
  else approveMeal(wrap, tour);
}

function approveMeal(wrap, tour) {
  const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
  if (pw !== ADMIN_PASSWORD) { alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); return; }
  const time = nowKSTString();
  setMealUI(wrap, "DONE", time);
  saveMealPaid(currentUser.id, tour, time);
  logMealPaymentToSheet({ action: "APPROVE", tour, time });
}

function setMealUI(wrap, mode, time = "") {
  const status = wrap.querySelector(".status");
  const btn = wrap.querySelector("button");
  if (mode === "DONE") {
    wrap.classList.add("done");
    status.textContent = "ì§€ê¸‰ ì™„ë£Œ";
    status.classList.remove("pending"); status.classList.add("done");
    wrap.dataset.time = time; btn.textContent = "ì§€ê¸‰ í™•ì¸";
  } else {
    wrap.classList.remove("done");
    status.textContent = "ì¤‘ì‹ë¹„ ë¯¸ì§€ê¸‰";
    status.classList.add("pending"); status.classList.remove("done");
    wrap.dataset.time = ""; btn.textContent = "ì§€ê¸‰ í™•ì¸";
  }
}
    
function mealKey(userId, tour) { return `mealPaid_${userId}_${tour}`; }
function saveMealPaid(userId, tour, time) { localStorage.setItem(mealKey(userId, tour), JSON.stringify({ time })); }
function loadMealPaid(userId, tour) { const raw = localStorage.getItem(mealKey(userId, tour)); return raw ? JSON.parse(raw) : null; }
function removeMealPaid(userId, tour) { localStorage.removeItem(mealKey(userId, tour)); }

function showMealDetail(wrap) {
  const time = wrap.dataset.time;
  const pw = prompt(`ì§€ê¸‰ ì™„ë£Œ ì‹œê°\n${time}\n\nì·¨ì†Œí•˜ë ¤ë©´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥\n(í™•ì¸ë§Œ ë³´ë ¤ë©´ ì·¨ì†Œ)`);
  if (!pw) return;
  if (pw !== ADMIN_PASSWORD) { alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜"); return; }
  if (confirm("ì§€ê¸‰ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    const tour = wrap.dataset.tour;
    const cancelTime = nowKSTString();
    setMealUI(wrap, "PENDING");
    removeMealPaid(currentUser.id, tour);
    logMealPaymentToSheet({ action: "CANCEL", tour, time: cancelTime });
  }
}

function nowKSTString() {
  return new Intl.DateTimeFormat("ko-KR", { timeZone: "Asia/Seoul", year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit", second: "2-digit" }).format(new Date());
}

const MEAL_SHEET_URL = "https://script.google.com/macros/s/AKfycbx2tVkT00Z8uXQWl6EeTIUUhZ3_NJHx3JDqSCHC5oJWkUCm0OtcTmaV6g20cNKoh0no9w/exec";

function logMealPaymentToSheet(payload) {
  if (!currentUser) return;
  fetch(MEAL_SHEET_URL, {
    method: "POST", mode: "no-cors",
    body: JSON.stringify({ type: "meal", id: currentUser.id, name: currentUser.name, action: payload.action, tour: payload.tour, time: payload.time })
  }).catch(console.error);
}
    
/* ================= ë¡œê·¸ì¸ (ğŸ”¥ ìˆ˜ì • 1. ìŠ¤í”Œë˜ì‹œ ì‚­ì œ) ================= */
function login() {
  const id = document.getElementById("employeeId").value.trim();
  const user = employees.find(e => e.id === id);

  if (!user) {
    document.getElementById("loginError").textContent = "ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ë²ˆì…ë‹ˆë‹¤.";
    return;
  }

  currentUser = user;

  // ë¡œê·¸ì¸ í™”ë©´ ì œê±°
  document.getElementById("loginSection").style.display = "none";

  // ğŸ“± ëª¨ë°”ì¼: ìŠ¤í”Œë˜ì‹œ ì—†ì´ ì¦‰ì‹œ ë©”ì¸ìœ¼ë¡œ ì§„ì…í•˜ë„ë¡ ìˆ˜ì •
  document.getElementById("mainSection").style.display = "block";

  document.getElementById("employeeName").textContent = user.name;
  document.body.classList.add("logged-in");
}

/* ================= ë¡œê·¸ì•„ì›ƒ (ğŸ”¥ ìˆ˜ì •: ì‹ ê·œ ì¶”ê°€) ================= */
function logout() {
  if(!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
  
  currentUser = null;
  document.body.classList.remove("logged-in");
  document.body.classList.remove("menu-open");
  
  // ë©”ì¸ ìˆ¨ê¸°ê³  ë¡œê·¸ì¸ í™”ë©´ ë³´ì´ê¸°
  document.getElementById("mainSection").style.display = "none";
  document.getElementById("loginSection").style.display = "block";
  document.getElementById("employeeId").value = "";
  
  // ì—´ë ¤ìˆëŠ” ìƒì„¸í˜ì´ì§€ ë‹«ê¸°
  goHome(); 
}

function tryAutoLogin() {
  const params = new URLSearchParams(window.location.search);
  const eid = params.get("eid");

  if (!eid) return;

  // inputì— ì‚¬ë²ˆ ì£¼ì…
  const input = document.getElementById("employeeId");
  if (input) input.value = eid;

  const user = employees.find(e => String(e.id) === String(eid));
  if (!user) {
    document.getElementById("loginError").textContent = "QR ì‚¬ë²ˆì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    return;
  }

  // ğŸ”¥ ì—¬ê¸°ì„œ ë
  login();
}

/* ================= ì—¬í–‰ ì¼ì • ë°ì´í„° ================= */
const travelSchedule = [
  {
    day: "DAY 1", date: "2026.03.11 (ìˆ˜)", title: "ì¸ì²œ â†’ íƒ€ì´ë² ì´ / ì‹œë‚´ í•˜ì´ë¼ì´íŠ¸",
    items: [
      { time:"08:00/9:00", icon:"âœˆï¸", title:"ì¸ì²œ êµ­ì œê³µí•­ ì¶œë°œ", desc:"OZ 711 / KE 2021" },
      { time:"12:30/13:30", icon:"ğŸœ", title:"ì¤‘ì‹ | ìš°ìœ¡ë©´", desc:"í˜„ì§€ ì¸ê¸° ì¤‘ì‹ë‹¹" },
      { time:"13:30/14:30", icon:"ğŸ›ï¸", title:"ë‹¨ìˆ˜ì´ ì˜›ê±°ë¦¬/í™ë§ˆì˜¤ì²­/ì§„ë¦¬ëŒ€í•™", desc:"í™ë§ˆì˜¤ì²­Â·ì˜›ê±°ë¦¬ ê´€ê´‘" },
      { time:"16:30/17:30", icon:"ğŸ¨", title:"í˜¸í…” ì²´í¬ì¸", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" },
      { time:"18:00/18:30", icon:"ğŸ½ï¸", title:"ì„ì‹ | íƒ€ì¹´ì˜¤ ìƒ¤ë¸Œìƒ¤ë¸Œ", desc:"ë¬´ì œí•œ ìƒ¤ë¸Œìƒ¤ë¸Œ" },
      { time:"19:30/20:00", icon:"ğŸŒƒ", title:"íƒ€ì´ë² ì´ 101 ì „ë§ëŒ€", desc:"ì•¼ê²½ ê´€ëŒ" },
      { time:"21:00/21:30", icon:"ğŸ¨", title:"í˜¸í…”ë³µê·€", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" }
    ]
  },
  {
    day: "DAY 2", date: "2026.03.12 (ëª©)", title: "ì„ íƒ ê´€ê´‘ / ë§Œì°¬",
    items: [
      { time:"08:30/9:00", icon:"ğŸšŒ", title:"ì„ íƒ ê´€ê´‘", desc:"ê°œì¸ ì„ íƒ ì¼ì •" },
      { time:"08:30", icon:"ğŸšŒ", title:"í‹°ì—”ë¼ì´ ì˜¨ì²œ", desc:"ì„ íƒ 1ì•ˆ" },
      { time:"9:00", icon:"ğŸ›ï¸", title:"ê³ ê¶ë°•ë¬¼ê´€", desc:"ì„ íƒ 2ì•ˆ" },
      { time:"13:00", icon:"ğŸ½ï¸", title:"ì¤‘ì‹", desc:"ë² ì´ì§•ë•" },
      { time:"14:30", icon:"ğŸ›ï¸", title:"ì„œë¬¸ì •", desc:"ê°œì¸ ì„ íƒ ì¼ì •" },
      { time:"08:30/9:00", icon:"ğŸ§­", title:"ììœ ì‹œê°„", desc:"ì¤‘ì‹ë¹„ ì§€ê¸‰" },
      { time:"18:00", icon:"ğŸ‰", title:"ISC ë§Œì°¬", desc:"í•„ìˆ˜ ì°¸ì„" }
    ]
  },
  {
    day: "DAY 3", date: "2026.03.13 (ê¸ˆ)", title: "ê·¼êµ ê´€ê´‘",
    items: [
      { time:"10:00", icon:"ğŸ¨ğŸ½ï¸", title:"í˜¸í…” ì¡°ì‹ í›„ ì¶œë°œ", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" },
      { time:"11:00", icon:"ğŸŒŠ", title:"ì•¼ë¥˜ í•´ìƒê³µì›", desc:"ê¸°ì•”ê´´ì„ ê´€ê´‘" },
      { time:"12:30", icon:"ğŸ¦", title:"ì¤‘ì‹ : ì”¨í‘¸ë“œ", desc:"í˜„ì§€ í•´ì‚°ë¬¼ íŠ¹ì‹" },
      { time:"14:30", icon:"ğŸ®", title:"ìŠ¤í€ ì²œë“±ë‚ ë¦¬ê¸°", desc:"ì†Œì›ì²œë“± ë‚ ë¦¬ê¸°" },
      { time:"17:00", icon:"ğŸ®", title:"ì§€ìš°í€ ì•¼ê²½", desc:"í™ë“±ë§ˆì„" },
      { time:"20:00", icon:"ğŸŒŠ", title:"ì•¼ì‹œì¥ ë° ì„ì‹", desc:"ì•¼ì‹œì¥ ììœ ì‹ ë° ì‡¼í•‘" },
      { time:"21:30", icon:"ğŸ¨", title:"í˜¸í…”ë³µê·€", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" },
      { time:"ì „ì¼", icon:"ğŸ§­", title:"ììœ ì¼ì • ì„ íƒì‹œ", desc:"ì „ì²´ ê°œì¸ë¶€ë‹´(ì¤‘ì‹ë¹„ ì§€ê¸‰ X)" }
    ]
  },
  {
    day: "DAY 4", date: "2026.03.14 (í† )", title: "ê·€êµ­",
    items: [
      { time:"08:00/9:00", icon:"ğŸ¨", title:"í˜¸í…” ì²´í¬ì•„ì›ƒ", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" },
      { time:"11:40/12:25", icon:"âœˆï¸", title:"íƒ€ì´ë² ì´ ì¶œë°œ", desc:"OZ 712 / KE 2022" },
      { time:"15:25/15:50", icon:"ğŸ‡°ğŸ‡·", title:"ì¸ì²œ ë„ì°©", desc:"ISC in Taiwan" }
    ]
  }
];
    
function normalizeTime(t) {
  const s = String(t).trim();
  const m = s.match(/^(\d{1,2}):(\d{2})$/);
  if (!m) return s;
  return `${String(m[1]).padStart(2, "0")}:${m[2]}`;
}

function pickTimeByAirline(timeStr, airline) {
  const parts = String(timeStr).split("/").map(s => normalizeTime(s));
  if (parts.length === 1) return parts[0];
  const isKoreanAir = String(airline || "").includes("ëŒ€í•œí•­ê³µ");
  return isKoreanAir ? parts[parts.length - 1] : parts[0];
}

function buildDay2ItemsForUser(user, userAirline) {
  const tours = user?.myTour || [];
  const hasTienlai = tours.some(v => String(v).includes("í‹°ì—”ë¼ì´"));
  const hasGugung  = tours.some(v => String(v).includes("ê³ ê¶ë°•ë¬¼ê´€"));
  const hasFree    = tours.some(v => String(v).includes("ììœ ì¼ì •"));

  const day2 = travelSchedule.find(d => d.day === "DAY 2");
  const items = day2?.items || [];
  const byTitle = (title) => items.find(x => x.title === title);

  const itemSelect = byTitle("ì„ íƒ ê´€ê´‘");
  const itemTienlai = byTitle("í‹°ì—”ë¼ì´ ì˜¨ì²œ");
  const itemGugung  = byTitle("ê³ ê¶ë°•ë¬¼ê´€");
  const itemLunch   = byTitle("ì¤‘ì‹");
  const itemXimen   = byTitle("ì„œë¬¸ì •");
  const itemFree    = byTitle("ììœ ì‹œê°„");
  const itemDinner  = byTitle("ISC ë§Œì°¬");

  if (hasTienlai && hasGugung && hasFree) return [...(itemSelect ? [itemSelect] : []), ...(itemLunch ? [itemLunch] : []), ...(itemXimen ? [itemXimen] : []), ...(itemDinner ? [itemDinner] : [])];
  if (hasFree && !hasTienlai && !hasGugung) return [...(itemFree ? [itemFree] : []), ...(itemDinner ? [itemDinner] : [])];
  if (hasTienlai) return [...(itemTienlai ? [itemTienlai] : []), ...(itemLunch ? [itemLunch] : []), ...(itemXimen ? [itemXimen] : []), ...(itemDinner ? [itemDinner] : [])];
  if (hasGugung) return [...(itemGugung ? [itemGugung] : []), ...(itemLunch ? [itemLunch] : []), ...(itemXimen ? [itemXimen] : []), ...(itemDinner ? [itemDinner] : [])];
  
  return [...(itemSelect ? [itemSelect] : []), ...(itemDinner ? [itemDinner] : [])];
}

function pickFlightDescByAirline(desc, airline) {
  const s = String(desc || "");
  if (!s.includes("/")) return s;
  const isKoreanAir = String(airline || "").includes("ëŒ€í•œí•­ê³µ");
  const parts = s.split("/").map(v => v.trim()); 
  return isKoreanAir ? (parts[1] || s) : (parts[0] || s);
}

/* ================= í˜ì´ì§€ ì˜¤í”ˆ ë¡œì§ ================= */
function openPage(type, fromHistory = false) {
  document.body.classList.remove('menu-open'); // ë©”ë‰´ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°

  const userAirline = currentUser?.flight?.departure?.airline || ""; 
  
  if (!fromHistory) pageHistory.push(type);

  const detail = document.getElementById("detailPage");
  detail.style.display = "block";
  requestAnimationFrame(() => { document.body.classList.add("detail-open"); });

  const t = document.getElementById("detailTitle");
  const c = document.getElementById("detailContent");

  // âœ… DAY 1 ~ 4 ë²„íŠ¼ ì²˜ë¦¬ (í”„ë¦¬ë¯¸ì—„ ë””ìì¸ ì ìš©ë¶€)
  if (type.startsWith("day_")) {
    const idx = parseInt(type.split("_")[1]);
    const day = travelSchedule[idx];
    t.textContent = `ğŸ—“ ${day.day} ì¼ì •`;

    const items = (day.day === "DAY 2") ? buildDay2ItemsForUser(currentUser, userAirline) : day.items;

    c.innerHTML = `
      <div class="detail-content-wrap">
        <div class="day-card">
          <h3>${day.day} <span>${day.date}</span></h3>
          <p class="day-title">${day.title}</p>
          <div class="timeline">
            ${items.map(i => `
              <div class="schedule-item">
                <div class="timeline-dot"></div>
                <div class="schedule-card">
                  <div class="schedule-time">${pickTimeByAirline(i.time, userAirline)}</div>
                  <div class="schedule-body">
                    <div class="schedule-title">${i.icon} ${i.title}</div>
                    ${i.desc ? `<div class="schedule-desc">${pickFlightDescByAirline(i.desc, userAirline)}</div>` : ""}
                  </div>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      </div>
    `;
    return;
  }

  // ë©”ë‰´ ì²˜ë¦¬
  if (type === "flight") {
    const dep = currentUser.flight.departure;
    const ret = currentUser.flight.return;
    t.textContent = "âœˆï¸ í•­ê³µí¸ ì •ë³´";
    c.innerHTML = `
      <div class="detail-content-wrap">
        <div class="day-card"><h3>ì¶œêµ­í¸</h3><div class="schedule-item"><div class="schedule-card"><div class="schedule-time">${dep.time}</div><div class="schedule-body"><div class="schedule-title">âœˆï¸ ${dep.from} â†’ ${dep.to}</div><div class="schedule-desc">${dep.airline} ${dep.flightNo}</div><div class="schedule-desc">${dep.date}</div></div></div></div></div>
        <div class="day-card"><h3>ê·€êµ­í¸</h3><div class="schedule-item"><div class="schedule-card"><div class="schedule-time">${ret.time}</div><div class="schedule-body"><div class="schedule-title">ğŸ  ${ret.from} â†’ ${ret.to}</div><div class="schedule-desc">${ret.airline} ${ret.flightNo}</div><div class="schedule-desc">${ret.date}</div></div></div></div></div>
      </div>`;
  }

  if (type === "myTour") {
    t.textContent = "ğŸ’ ë‚˜ì˜ ì„ íƒ ê´€ê´‘";
    c.innerHTML = `<div class="detail-content-wrap"><div class="mytour-wrap">${renderMyTour()}</div></div>`;
    setTimeout(() => {
      const wrap = document.querySelector('.meal-check[data-tour="ììœ ì¼ì •"]');
      if (!wrap) return;
      syncMealStatusFromServer(currentUser.id, "ììœ ì¼ì •", wrap);
      const saved = loadMealPaid(currentUser.id, "ììœ ì¼ì •");
      if (!wrap.classList.contains("done") && saved?.time) setMealUI(wrap, "DONE", saved.time);
    }, 0);
  }

  if (type === "taiwan") {
    t.textContent = "ğŸ‡¹ğŸ‡¼ ëŒ€ë§Œì˜ ëª¨ë“  ê²ƒ";
    c.innerHTML = `
      <div class="detail-content-wrap">
        <div class="country-compare-grid">
          <!-- ëŒ€í•œë¯¼êµ­ -->
          <div class="country-card">
            <div class="country-header">
              <img src="assets/images/flag-kr.jpg" class="flag-img" onerror="this.style.display='none'">
              <h3>ëŒ€í•œë¯¼êµ­</h3>
            </div>
            <div class="time-box">
              <span class="time-label">í˜„ì¬ ì‹œê°</span>
              <strong id="timeKR">--:--:--</strong>
            </div>
            <ul class="country-list">
              <li><span>ì‹œì°¨</span><strong>ê¸°ì¤€ êµ­ê°€</strong></li>
              <li><span>ì¸êµ¬</span><strong>ì•½ 5,100ë§Œ ëª…</strong></li>
              <li><span>ë©´ì </span><strong>ì•½ 100,210ã¢</strong></li>
              <li><span>GDP</span><strong>ì•½ 1.7ì¡° ë‹¬ëŸ¬</strong></li>
            </ul>
          </div>

          <!-- ëŒ€ë§Œ -->
          <div class="country-card">
            <div class="country-header">
              <img src="assets/images/flag-tw.jpg" class="flag-img" onerror="this.style.display='none'">
              <h3>ëŒ€ë§Œ</h3>
            </div>
            <div class="time-box">
              <span class="time-label">í˜„ì¬ ì‹œê°</span>
              <strong id="timeTW">--:--:--</strong>
            </div>
            <ul class="country-list">
              <li><span>ì‹œì°¨</span><strong>í•œêµ­ë³´ë‹¤ 1ì‹œê°„ ëŠë¦¼</strong></li>
              <li><span>ì¸êµ¬</span><strong>ì•½ 2,300ë§Œ ëª…</strong></li>
              <li><span>ë©´ì </span><strong>ì•½ 36,197ã¢</strong></li>
              <li><span>GDP</span><strong>ì•½ 0.8ì¡° ë‹¬ëŸ¬</strong></li>
            </ul>
          </div>
        </div>

        <!-- âœ… [ìˆ˜ì •] 1. ì‹¤ì‹œê°„ í™˜ìœ¨ ì •ë³´ í‘œì‹œ -->
        <div class="exchange-row">
            ì‹¤ì‹œê°„ í™˜ìœ¨: <strong>1 TWD â‰ˆ <span id="twFxRate">ë¡œë”©ì¤‘..</span>ì›</strong>
            <br><span style="font-size:12px; opacity:0.8;">(ì—…ë°ì´íŠ¸: <span id="twFxTime">-</span>)</span>
        </div>
        <p class="exchange-note" style="text-align:center; font-size:13px; font-weight:600; color:var(--text-sub);">â€» í™˜ìœ¨ì€ ì‹¤ì‹œê°„ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        
        <div class="day-card" style="margin-top:20px;">
          <h3 class="section-title">ê¸°ë³¸ ì •ë³´</h3>
          <div class="info-card-grid" style="display:grid; gap:12px; margin-top:12px;">
            <div class="info-card" style="background:var(--bg-main); padding:16px; border-radius:12px; display:flex; flex-direction:column; gap:6px;">
              <h4 style="margin:0; font-size:14px; font-weight:800; color:var(--primary-color); letter-spacing:-0.5px;">ğŸ‡¹ğŸ‡¼ êµ­ê¸°</h4>
              <p style="margin:0; font-size:13px; line-height:1.4; color:var(--text-main); word-break:keep-all;"><strong>ì²­ì²œë°±ì¼ë§Œì§€í™ê¸°</strong><br><span style="color:var(--text-sub); font-size:12px; font-weight:600;">ê´‘ëª… Â· ììœ  Â· í¬ìƒ</span></p>
            </div>
            <div class="info-card" style="background:var(--bg-main); padding:16px; border-radius:12px; display:flex; flex-direction:column; gap:6px;">
              <h4 style="margin:0; font-size:14px; font-weight:800; color:var(--primary-color); letter-spacing:-0.5px;">ğŸ—£ ì–¸ì–´</h4>
              <p style="margin:0; font-size:13px; font-weight:700; color:var(--text-main);">í‘œì¤€ ì¤‘êµ­ì–´ / ë²ˆì²´ í•œì</p>
            </div>
            <div class="info-card" style="background:var(--bg-main); padding:16px; border-radius:12px; display:flex; flex-direction:column; gap:6px;">
              <h4 style="margin:0; font-size:14px; font-weight:800; color:var(--primary-color); letter-spacing:-0.5px;">â˜€ï¸ ê¸°í›„</h4>
              <p style="margin:0; font-size:13px; font-weight:700; color:var(--text-main);">3ì›” í‰ê·  18~25â„ƒ</p>
            </div>
          </div>
        </div>
      </div>`;
    startWorldClock();
    
    // âœ… [ìˆ˜ì •] 1-2. í™˜ìœ¨ API í˜¸ì¶œ
    getFxRate().then(data => {
        const r = document.getElementById("twFxRate");
        const t = document.getElementById("twFxTime");
        if(r) r.textContent = fxFmt(data.rate);
        if(t) t.textContent = data.updatedUtc || "ë°©ê¸ˆ";
    });
  }

  if (type === "exchange") {
    t.textContent = "ğŸ’± í™˜ìœ¨ ê³„ì‚°ê¸°";
    c.innerHTML = `
      <div class="detail-content-wrap">
        <div class="exchange-row">í™˜ìœ¨: <strong>1 TWD â‰ˆ <span id="fxRateText">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</span>ì›</strong><br><span style="font-size:12px; color:#6b7280;">ì—…ë°ì´íŠ¸: <span id="fxUpdatedText">-</span></span><div style="margin-top:10px;"><button class="primary-btn" id="fxRefreshBtn" style="max-width:220px;">í™˜ìœ¨ ìƒˆë¡œê³ ì¹¨</button></div></div>
        <div class="day-card"><h3 class="section-title">TWD â†” KRW ê³„ì‚°</h3><div class="fx-grid"><div class="fx-box"><label>ëŒ€ë§Œë‹¬ëŸ¬ (TWD)</label><input id="inputTWD" type="text" inputmode="decimal" placeholder="ì˜ˆ: 1000"></div><div class="fx-eq">â‡„</div><div class="fx-box"><label>ì›í™” (KRW)</label><input id="inputKRW" type="text" inputmode="decimal" placeholder="ì˜ˆ: 42000"></div></div><p class="fx-note" style="margin-top:10px; font-size:13px; color:#6b7280; text-align:center;">â€» ìˆ«ì ì…ë ¥ ì‹œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</p></div>
      </div>`;
    initExchangeCalculatorAuto();
  }

  if (type === "dinner") {
    t.textContent = "ğŸ½ ë§Œì°¬ ì•ˆë‚´";
    c.innerHTML = `<div class="detail-content-wrap"><div class="day-card"><h3>ISC ê³µì‹ ë§Œì°¬</h3><p style="margin-top:10px; font-size:14px; color:var(--text-sub);">ë§Œì°¬ì— ê´€ë ¨ëœ ìƒì„¸ ì •ë³´ê°€ ì¶”í›„ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤.</p></div></div>`;
  }
   
  if (type === "request") {
    t.textContent = "ğŸ“ ìš”ì²­ì‚¬í•­";
    c.innerHTML = `<div class="detail-content-wrap"><div class="day-card"><textarea id="requestInput" placeholder="ìš”ì²­ì‚¬í•­ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”."></textarea><button class="primary-btn" onclick="submitRequest()">ì œì¶œí•˜ê¸°</button></div></div>`;
  }
   
  if (type === "contact") {
    t.textContent = "ğŸ“ ê¸´ê¸‰ ì—°ë½ë§";
    c.innerHTML = `
      <div class="detail-content-wrap"><div class="day-card"><h3>ë¹„ìƒ ì—°ë½ë§</h3><div class="timeline">
      <div class="schedule-item"><div class="timeline-dot"></div><div class="schedule-card"><div class="schedule-body"><div class="schedule-title">ğŸ“ ì¸ì¹´ë¸”ë£¨íˆ¬ì–´</div><div class="schedule-desc">ë‹´ë‹¹ì í™ê¸¸ë™ | 010-0000-0000</div></div></div></div>
      <div class="schedule-item"><div class="timeline-dot"></div><div class="schedule-card"><div class="schedule-body"><div class="schedule-title">ğŸ“ ì¸ì¹´ ë§ˆì¼€íŒ…ë¶€</div><div class="schedule-desc">ë‹´ë‹¹ì í˜„ë³´ë¼ê³¼ì¥ | 02-6214-0000</div></div></div></div>
      <div class="schedule-item"><div class="timeline-dot"></div><div class="schedule-card"><div class="schedule-body"><div class="schedule-title">ğŸ“ í˜„ì§€ ê°€ì´ë“œ</div><div class="schedule-desc">ë‹´ë‹¹ì Jason | +886-900-222-222</div></div></div></div>
      </div></div></div>`;
  }
}

async function syncMealStatusFromServer(userId, tour, wrap) {
  const url = `${MEAL_SHEET_URL}?mode=customerAdmin&id=${userId}`;
  const res = await fetch(url);
  const data = await res.json();
  const status = data.mealMap?.[tour];
  if (status === "APPROVE") setMealUI(wrap, "DONE", "ì„œë²„ ê¸°ì¤€");
  else setMealUI(wrap, "PENDING");
}

/* ================= í™ˆìœ¼ë¡œ ================= */
function goHome() {
  pageHistory = [];
  document.body.classList.remove("detail-open");
  document.body.classList.remove("menu-open");

  // ğŸ”¥ ì• ë‹ˆë©”ì´ì…˜(0.4ì´ˆ)ì´ ëë‚œ í›„ ì™„ì „íˆ ìˆ¨ê²¨ì„œ í„°ì¹˜ ë°©í•´ ë°©ì§€
  setTimeout(() => {
    document.getElementById("detailPage").style.display = "none";
  }, 400); 
}

/* ================= ë’¤ë¡œê°€ê¸° ================= */
function goBack() {
  pageHistory.pop();
   
  if (pageHistory.length === 0) { 
    goHome(); 
    return; 
  }
   
  const prevType = pageHistory[pageHistory.length - 1];
  openPage(prevType, true);
}

/* ================= ìš”ì²­ì‚¬í•­ ì „ì†¡ ================= */
function submitRequest() {
  const requestText = document.getElementById("requestInput").value.trim();
  if (!requestText) { alert("ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
  if (!currentUser) { alert("ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
   
  fetch(MEAL_SHEET_URL, {
    method: "POST", mode: "no-cors",
    body: JSON.stringify({ type: "request", id: currentUser.id, name: currentUser.name, request: requestText, time: nowKSTString() })
  }).then(() => { alert("ìš”ì²­ì‚¬í•­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."); document.getElementById("requestInput").value = ""; }).catch(err => { console.error(err); alert("ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); });
}

function startWorldClock() {
  function updateTime() {
    const now = new Date();
    const kr = new Intl.DateTimeFormat("ko-KR", { timeZone: "Asia/Seoul", hour: "2-digit", minute: "2-digit", second: "2-digit" }).format(now);
    const tw = new Intl.DateTimeFormat("zh-TW", { timeZone: "Asia/Taipei", hour: "2-digit", minute: "2-digit", second: "2-digit" }).format(now);
    const krEl = document.getElementById("timeKR");
    const twEl = document.getElementById("timeTW");
    if (krEl && twEl) { krEl.textContent = kr; twEl.textContent = tw; }
  }
  updateTime();
  setInterval(updateTime, 1000);
}

const FX_CACHE_KEY = "fx_twd_krw_cache_v1";
const FX_CACHE_MS = 6 * 60 * 60 * 1000; 

function fxParse(v) {
  if (v == null) return NaN;
  const x = String(v).replace(/,/g, "").trim();
  if (x === "") return NaN;
  return Number(x);
}

function fxFmt(n) {
  if (!isFinite(n)) return "";
  const isInt = Math.abs(n - Math.round(n)) < 1e-10;
  return (isInt ? Math.round(n) : n).toLocaleString("ko-KR", { maximumFractionDigits: 2 });
}

async function fetchTwdToKrwRate() {
  const url = "https://open.er-api.com/v6/latest/USD";
  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) throw new Error("í™˜ìœ¨ API ì‹¤íŒ¨: " + res.status);
  const data = await res.json();
  const krwPerUsd = data?.rates?.KRW;
  const twdPerUsd = data?.rates?.TWD;
  if (!isFinite(krwPerUsd) || !isFinite(twdPerUsd)) throw new Error("KRW/TWD í™˜ìœ¨ ë°ì´í„° ì—†ìŒ");
  return { rate: krwPerUsd / twdPerUsd, updatedUtc: data.time_last_update_utc || "" };
}

function loadFxCache() {
  const raw = localStorage.getItem(FX_CACHE_KEY);
  if (!raw) return null;
  try {
    const v = JSON.parse(raw);
    if (!v.rate || !v.savedAt) return null;
    if (Date.now() - v.savedAt > FX_CACHE_MS) return null; 
    return v;
  } catch { return null; }
}

function saveFxCache(payload) {
  localStorage.setItem(FX_CACHE_KEY, JSON.stringify({ rate: payload.rate, updatedUtc: payload.updatedUtc, savedAt: Date.now() }));
}

async function getFxRate({ force = false } = {}) {
  if (!force) { const cached = loadFxCache(); if (cached) return cached; }
  const fresh = await fetchTwdToKrwRate();
  saveFxCache(fresh); return loadFxCache() || fresh;
}

function initExchangeCalculatorAuto() {
  const twdEl = document.getElementById("inputTWD");
  const krwEl = document.getElementById("inputKRW");
  const rateText = document.getElementById("fxRateText");
  const updatedText = document.getElementById("fxUpdatedText");
  const refreshBtn = document.getElementById("fxRefreshBtn");
  if (!twdEl || !krwEl || !rateText || !updatedText) return;

  let syncing = false; let rate = NaN; 

  function updateFromTWD() {
    if (syncing) return; syncing = true;
    const twd = fxParse(twdEl.value);
    if (!isFinite(twd) || !isFinite(rate)) { krwEl.value = ""; syncing = false; return; }
    krwEl.value = fxFmt(twd * rate); syncing = false;
  }
  function updateFromKRW() {
    if (syncing) return; syncing = true;
    const krw = fxParse(krwEl.value);
    if (!isFinite(krw) || !isFinite(rate) || rate === 0) { twdEl.value = ""; syncing = false; return; }
    twdEl.value = fxFmt(krw / rate); syncing = false;
  }

  twdEl.addEventListener("input", updateFromTWD);
  krwEl.addEventListener("input", updateFromKRW);

  async function renderRate(force = false) {
    rateText.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
    try {
      const fx = await getFxRate({ force });
      rate = Number(fx.rate);
      rateText.textContent = fxFmt(rate);
      updatedText.textContent = fx.updatedUtc || "-";
      const hasT = String(twdEl.value).trim() !== "";
      const hasK = String(krwEl.value).trim() !== "";
      if (hasT) updateFromTWD(); else if (hasK) updateFromKRW();
    } catch (e) {
      console.error(e); rateText.textContent = "ì‹¤íŒ¨"; updatedText.textContent = "-"; alert("í™˜ìœ¨ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
    }
  }
  if (refreshBtn) refreshBtn.addEventListener("click", () => renderRate(true));
  renderRate(false);
}
</script>

</body>
</html>
