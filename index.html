<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2025 ISC ëŒ€ë§Œ ì—¬í–‰</title>

  <!-- ê³µí†µ + ë””ë°”ì´ìŠ¤ë³„ -->
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/desktop.css" media="(min-width: 768px)">
  <link rel="stylesheet" href="css/mobile.css" media="(max-width: 767px)">
</head>
<body>

  <!-- ===== HEADER (ë¡œê·¸ì¸ í›„ì—ë§Œ ë³´ì—¬ì¤Œ) ===== -->
  <header class="header" id="topHeader" style="display:none;">
    <img src="assets/images/logo.png" class="logo" alt="INCAR ë¡œê³ ">
    <div class="header-text">
      <h1>2025 ISC ëŒ€ë§Œ ì—¬í–‰</h1>
      <p class="sub">2026.03.11 ~ 03.14 | ì¸ì¹´ê¸ˆìœµì„œë¹„ìŠ¤</p>
    </div>
  </header>

  <!-- ===== LOGIN HERO ===== -->
  <section id="loginSection" class="login-hero">
    <div class="hero-overlay">
      <div class="login-box">
        <img src="assets/images/logo.png" class="hero-logo" alt="INCAR ë¡œê³ ">
        <h2 class="hero-title">2025 ISC Taiwan</h2>
        <p class="hero-desc">ì°¸ê°€ì ì „ìš© í¬í„¸ Â· ì‚¬ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>

        <input type="text" id="employeeId" placeholder="ì‚¬ë²ˆ ì…ë ¥">
        <button class="primary-btn" onclick="login()">ë¡œê·¸ì¸</button>
        <p id="loginError" class="error"></p>

        <p class="hero-footnote">â€» ë¬¸ì œê°€ ìˆìœ¼ë©´ ìš´ì˜ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</p>
      </div>
    </div>
  </section>

  <!-- ===== MAIN (ë¡œê·¸ì¸ í›„) ===== -->
  <main id="mainSection" style="display:none;">
    <p class="welcome"><strong id="employeeName"></strong> ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤</p>

    <div class="menu">
      <button onclick="openPage('schedule')">ğŸ—“ ì—¬í–‰ ì¼ì •</button>
      <button onclick="openPage('flight')">âœˆï¸ í•­ê³µí¸ ì •ë³´</button>
      <button onclick="openPage('tour')">ğŸ“ ê´€ê´‘ì§€ ì„¤ëª…</button>
      <button onclick="openPage('myTour')">ğŸ’ ë‚˜ì˜ ì„ íƒ ê´€ê´‘</button>
      <button onclick="openPage('dinner')">ğŸ½ ë§Œì°¬ ì•ˆë‚´</button>
      <button onclick="openPage('request')">ğŸ“ ìš”ì²­ì‚¬í•­</button>
      <button onclick="openPage('contact')">ğŸ“ ê¸´ê¸‰ ì—°ë½ë§</button>
    </div>
  </main>

  <!-- ===== DETAIL PAGE (ìŠ¬ë¼ì´ë“œì—… ë ˆì´ì–´) ===== -->
  <section id="detailPage" class="detail" style="display:none;">
    <h2 id="detailTitle"></h2>
    <div id="detailContent"></div>

    <div class="nav-buttons">
      <button class="ghost-btn" onclick="goHome()">í™ˆìœ¼ë¡œ</button>
      <button class="ghost-btn" onclick="goBack()">ë’¤ë¡œê°€ê¸°</button>
    </div>
  </section>

  <script>
    // ====== ìƒíƒœ ======
    let employees = [];
    let currentUser = null;
    let pageStack = [];

    // ====== ì§ì› ë°ì´í„° ë¡œë“œ (ìºì‹œ ë°©ì§€) ======
    fetch("people/employees.json?ts=" + Date.now())
      .then(res => res.json())
      .then(data => { employees = data; })
      .catch(() => {
        const err = document.getElementById("loginError");
        if (err) err.textContent = "ì§ì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤(people/employees.json í™•ì¸).";
      });

    // ====== ë¡œê·¸ì¸ ======
    function login() {
      const id = document.getElementById("employeeId").value.trim();
      const user = employees.find(e => e.id === id);

      if (!user) {
        document.getElementById("loginError").textContent = "ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ë²ˆì…ë‹ˆë‹¤.";
        return;
      }

      currentUser = user;

      // í™”ë©´ ì „í™˜
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("topHeader").style.display = "flex";
      document.getElementById("mainSection").style.display = "block";

      document.getElementById("employeeName").textContent = user.name;
      document.getElementById("loginError").textContent = "";
    }

    // ====== ìƒì„¸ í˜ì´ì§€ ì—´ê¸° ======
    function openPage(type) {
      pageStack.push(type);

      document.getElementById("mainSection").style.display = "none";
      const detail = document.getElementById("detailPage");
      detail.style.display = "block";

      // ì• ë‹ˆë©”ì´ì…˜ ì¬íŠ¸ë¦¬ê±° (ì—°ì† í´ë¦­ì‹œì—ë„ ì˜¬ë¼ì˜¤ê²Œ)
      detail.classList.remove("animate-in");
      void detail.offsetWidth;
      detail.classList.add("animate-in");

      const title = document.getElementById("detailTitle");
      const content = document.getElementById("detailContent");

      // ê³µí†µ ì´ˆê¸°í™”
      title.textContent = "";
      content.innerHTML = "";

      if (type === "schedule") {
        title.textContent = "ğŸ—“ ì—¬í–‰ ì¼ì •";
        content.innerHTML = `
          <div class="card">
            <p class="muted">â€» ìƒì„¸ ì¼ì •í‘œ ê¸°ì¤€ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
            <ul class="list">
              <li>1ì¼ì°¨: ì…êµ­ / ì‹œë‚´ ì£¼ìš” ì¼ì •</li>
              <li>2ì¼ì°¨: ì„ íƒ ì¼ì • + ë§Œì°¬</li>
              <li>3ì¼ì°¨: ê·¼êµ íˆ¬ì–´</li>
              <li>4ì¼ì°¨: ê·€êµ­</li>
            </ul>
          </div>
        `;
      }

      if (type === "flight") {
        title.textContent = "âœˆï¸ í•­ê³µí¸ ì •ë³´";
        const txt = (currentUser && currentUser.flight) ? currentUser.flight : "í•­ê³µí¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
        content.innerHTML = `
          <div class="card">
            <p>${escapeHtml(txt)}</p>
            <p class="muted">â€» í•­ê³µí¸ ì •ë³´ëŠ” people/employees.json ìˆ˜ì • ì‹œ ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
          </div>
        `;
      }

      if (type === "tour") {
        title.textContent = "ğŸ“ ê´€ê´‘ì§€ ì„¤ëª…";
        content.innerHTML = `
          <div class="card">
            <p class="muted">ì˜ˆì‹œ ë¬¸êµ¬ì…ë‹ˆë‹¤. ì‹¤ì œ ì¼ì •í‘œ ê¸°ì¤€ìœ¼ë¡œ í…ìŠ¤íŠ¸ë¥¼ ê³„ì† ì—…ë°ì´íŠ¸í•˜ë©´ ë©ë‹ˆë‹¤.</p>
            <div class="grid2">
              <div class="mini-card">
                <h3>ì¤‘ì •ê¸°ë…ë‹¹</h3>
                <p>ëŒ€ë§Œ í˜„ëŒ€ì‚¬ì˜ ìƒì§•ì ì¸ ëœë“œë§ˆí¬.</p>
              </div>
              <div class="mini-card">
                <h3>ê³ ê¶ë°•ë¬¼ì›</h3>
                <p>ì¤‘í™” ë¬¸í™”ê¶Œ ìµœëŒ€ ê·œëª¨ê¸‰ ì»¬ë ‰ì…˜.</p>
              </div>
              <div class="mini-card">
                <h3>ì•¼ì‹œì¥</h3>
                <p>í˜„ì§€ ë¨¹ê±°ë¦¬ì™€ ì‡¼í•‘ì„ ì¦ê¸¸ ìˆ˜ ìˆëŠ” í•„ìˆ˜ ì½”ìŠ¤.</p>
              </div>
              <div class="mini-card">
                <h3>ë„ì‹¬ ëª…ì†Œ</h3>
                <p>í–‰ì‚¬ ë™ì„ ì— ë§ì¶˜ í•µì‹¬ í¬ì¸íŠ¸ ì¤‘ì‹¬ìœ¼ë¡œ ì•ˆë‚´.</p>
              </div>
            </div>
          </div>
        `;
      }

      if (type === "myTour") {
        title.textContent = "ğŸ’ ë‚˜ì˜ ì„ íƒ ê´€ê´‘";
        const tours = (currentUser && Array.isArray(currentUser.myTour)) ? currentUser.myTour : [];
        if (tours.length === 0) {
          content.innerHTML = `
            <div class="card">
              <p>ì„ íƒí•œ ê´€ê´‘ì´ ì—†ìŠµë‹ˆë‹¤.</p>
              <p class="muted">people/employees.jsonì— myTourë¥¼ ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
          `;
        } else {
          content.innerHTML = `
            <div class="card">
              <p class="muted">ì•„ë˜ ë‚´ìš©ì€ ë³¸ì¸ ì„ íƒ í•­ëª©ì…ë‹ˆë‹¤.</p>
              <ul class="mytour-list">
                ${tours.map(t => `<li>${escapeHtml(String(t))}</li>`).join("")}
              </ul>
              <p class="muted">â€» ë³€ê²½ì€ people/employees.jsonì—ì„œ myTourë§Œ ìˆ˜ì •í•˜ë©´ ë©ë‹ˆë‹¤.</p>
            </div>
          `;
        }
      }

      if (type === "dinner") {
        title.textContent = "ğŸ½ ë§Œì°¬ ì•ˆë‚´";
        content.innerHTML = `
          <div class="card">
            <p><strong>í•„ìˆ˜ ì°¸ì„</strong> ì¼ì •ì…ë‹ˆë‹¤.</p>
            <ul class="list">
              <li>ì§‘í•© ì‹œê°„/ì¥ì†Œ: í–‰ì‚¬ ìš´ì˜ ê³µì§€ì— ë”°ë¼ ì—…ë°ì´íŠ¸</li>
              <li>ë“œë ˆìŠ¤ì½”ë“œ: ì¶”í›„ ê³µì§€</li>
              <li>ì¢Œì„/íŒ€: í˜„ì¥ ì•ˆë‚´</li>
            </ul>
          </div>
        `;
      }

      if (type === "request") {
        title.textContent = "ğŸ“ ìš”ì²­ì‚¬í•­";
        content.innerHTML = `
          <div class="card">
            <p class="muted">ì˜ˆ: ê¸°ë‚´ì‹, ë£¸ íƒ€ì…, ë™í–‰ ìš”ì²­, ì•Œë ˆë¥´ê¸° ë“±</p>
            <textarea id="requestText" placeholder="ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            <button class="primary-btn" onclick="submitRequest()">ì œì¶œ</button>
            <p id="submitMessage" class="success"></p>
          </div>
        `;
      }

      if (type === "contact") {
        title.textContent = "ğŸ“ ê¸´ê¸‰ ì—°ë½ë§";
        content.innerHTML = `
          <div class="card">
            <ul class="list">
              <li>í˜„ì§€ ë‹´ë‹¹: (ì¶”í›„ ì…ë ¥)</li>
              <li>í•œêµ­ ë‹´ë‹¹: (ì¶”í›„ ì…ë ¥)</li>
              <li>ì—¬í–‰ì‚¬ ë‹´ë‹¹: (ì¶”í›„ ì…ë ¥)</li>
            </ul>
          </div>
        `;
      }
    }

    // ====== ìš”ì²­ì‚¬í•­ ì „ì†¡ ======
    function submitRequest() {
      if (!currentUser) return;

      const text = document.getElementById("requestText").value.trim();
      if (!text) return alert("ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

      // âš ï¸ ì—¬ê¸°ë¥¼ ë°˜ë“œì‹œ ë„¤ Apps Script ì›¹ì•± URLë¡œ êµì²´
      const endpoint = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec";

      fetch(endpoint, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          id: currentUser.id,
          name: currentUser.name,
          request: text
        })
      });

      document.getElementById("submitMessage").textContent = "ì œì¶œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.";
      document.getElementById("requestText").value = "";
    }

    // ====== ë„¤ë¹„ê²Œì´ì…˜ ======
    function goHome() {
      pageStack = [];
      document.getElementById("detailPage").style.display = "none";
      document.getElementById("mainSection").style.display = "block";
    }

    function goBack() {
      pageStack.pop();
      if (pageStack.length === 0) goHome();
      // ë’¤ë¡œê°€ê¸°ëŠ” ë©”ì¸ìœ¼ë¡œë§Œ (ìš”êµ¬ëŒ€ë¡œ í™ˆ/ë’¤ë¡œ ì œê³µ)
    }

    // ====== XSS ë°©ì§€ìš© ê°„ë‹¨ ì´ìŠ¤ì¼€ì´í”„ ======
    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll("\"", "&quot;")
        .replaceAll("'", "&#039;");
    }
  </script>

</body>
</html>
