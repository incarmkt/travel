<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>2025 ISC ëŒ€ë§Œ ì—¬í–‰</title>

  <!-- âœ… [1] í°íŠ¸ CDN ì¶”ê°€ (Pretendard) -->
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

  <!-- âœ… [ì¶”ê°€] ì´ë¯¸ì§€ ë¹ ë¥¸ ë¡œë”©ì„ ìœ„í•œ Preload -->
  <link rel="preload" as="image" href="assets/images/taiwan.jpg">
  <link rel="preload" as="image" href="assets/images/home2.jpg">

  <!-- í”„ë¦¬ë¯¸ì—„ í…Œë§ˆ CSS -->
  <style>
    /* =========================================================
       [1] CSS ë³€ìˆ˜ & ì´ˆê¸°í™” (Premium Palette)
    ========================================================= */
    :root {
      --primary-color: #1a233a; 
      --accent-color: #c5a059;  
      --bg-main: #f5f7fa;        
      --card-bg: #ffffff;
      --text-main: #2d3748;
      --text-sub: #718096;
      --border-light: #edf2f7;
      --sheet-radius: 24px;
      --safe-bottom: env(safe-area-inset-bottom, 20px);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent; 
      /* âœ… í°íŠ¸ ì ìš© */
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    /* ğŸ”¥ [ìˆ˜ì •] ëª¨ë°”ì¼ í•˜ë‹¨ë°”/ìƒë‹¨ë°”ì— ì˜í•´ í™”ë©´ì´ ë°€ë¦¬ê±°ë‚˜ ì˜ë¦¬ëŠ” í˜„ìƒ ì™„ë²½ ë°©ì§€ */
    html, body {
      margin: 0;
      padding: 0;
      background-color: var(--primary-color);
      color: var(--text-main);
      overscroll-behavior: none; 
      width: 100%;
      height: 100%;
      height: 100dvh; /* ëª¨ë°”ì¼ ë™ì  ë†’ì´ ëŒ€ì‘ */
      overflow: hidden; /* ì´ì¤‘ ìŠ¤í¬ë¡¤ ë°©ì§€ */
    }

    /* iOS Safari ì „ìš© í•˜ë‹¨ë°” ì™„ë²½ ëŒ€ì‘ ì½”ë“œ */
    @supports (-webkit-touch-callout: none) {
      html, body {
        height: -webkit-fill-available;
      }
    }

    /* =========================================================
       [2] ìŠ¤í”Œë˜ì‹œ & ë¡œê·¸ì¸
    ========================================================= */
    /* ìŠ¤í”Œë˜ì‹œ ìŠ¤íƒ€ì¼ì€ ìœ ì§€í•˜ë˜ ë¡œì§ì—ì„œë§Œ ì œê±° */
    .mobile-splash {
      position: fixed; inset: 0; z-index: 9999;
      background: var(--primary-color);
      display: flex; align-items: center; justify-content: center;
    }
    .mobile-splash img { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }

    .login-hero {
      width: 100%;
      height: 100%; /* ë¶€ëª¨(body) í¬ê¸°ì— ë§ì¶° í•˜ë‹¨ë°” ì˜ë¦¼ ë°©ì§€ */
      background: url('assets/images/taiwan.jpg') center/cover no-repeat;
      position: fixed;
      top: 0; left: 0;
      z-index: 2000;
    }
    .hero-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(135deg, rgba(26,35,58,0.85) 0%, rgba(0,0,0,0.6) 100%);
      display: flex; align-items: center; justify-content: center;
      padding: 20px;
    }
    .login-box {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 40px 24px;
      border-radius: 20px;
      width: 100%;
      max-width: 380px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    
    .hero-logo { 
        width: 140px;       
        height: auto;       
        object-fit: contain;
        margin-bottom: 12px;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }

    .login-box h2 { color: var(--primary-color); margin: 0 0 5px; font-weight: 800; }
    .hero-desc { color: var(--text-sub); margin-bottom: 24px; font-size: 14px; }
    .login-box input {
      width: 100%; padding: 14px; border: 1px solid var(--border-light);
      border-radius: 12px; font-size: 16px; margin-bottom: 16px;
      text-align: center; transition: border 0.3s;
    }
    .login-box input:focus { border-color: var(--accent-color); outline: none; }
    .primary-btn {
      width: 100%; padding: 15px; border: none; border-radius: 12px;
      background: var(--primary-color); color: #fff; font-size: 16px; font-weight: 600;
      cursor: pointer; transition: background 0.3s, transform 0.1s;
    }
    .primary-btn:active { transform: scale(0.98); }
    .error { color: #e53e3e; font-size: 13px; margin-top: 12px; min-height: 18px; }

    /* =========================================================
       [3] í™ˆ í™”ë©´ (ë‹¨ì¼ í’€ìŠ¤í¬ë¦° ëŒ€ì‹œë³´ë“œ êµ¬ì¡°)
    ========================================================= */
    .main-bg { 
        width: 100%; 
        height: 100%; 
        overflow: hidden; 
    }
    
    .home-view {
      width: 100%;
      height: 100%; /* ëª¨ë°”ì¼ ì£¼ì†Œì°½ ëŒ€ì‘ ìœ„í•´ 100vh ëŒ€ì‹  100% ì‚¬ìš© */
      background: url('assets/images/home2.jpg') center/cover no-repeat;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    
    .home-overlay {
      position: absolute; inset: 0;
      background: transparent;
      z-index: 1;
    }

    /* ìƒë‹¨ í—¤ë” */
    .home-header {
      position: relative; z-index: 100;
      display: flex; justify-content: space-between; align-items: center;
      padding: 16px 20px; /* ğŸ”¥ ìƒë‹¨ í—¤ë” íŒ¨ë”© ì‚´ì§ ì¶•ì†Œ */
      padding-top: max(16px, env(safe-area-inset-top));
    }
    
    .header-logo { 
        height: 32px; /* ğŸ”¥ ë¡œê³  í¬ê¸° ì‚´ì§ ì¶•ì†Œ */      
        width: auto;        
        object-fit: contain;
    }
    
    /* =========================================================
       [4] ìš°ì¸¡ ìƒë‹¨ ì¹´í…Œê³ ë¦¬ (íŒì—… ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼) 
    ========================================================= */
    .menu-wrapper { 
        position: relative; 
        margin-left: auto;
    }

    /* ğŸ”¥ ì—¬í–‰ì •ë³´ ë©”ë‰´ ë²„íŠ¼ ì‹œì¸ì„± ìœ ì§€ */
    .menu-btn {
      background: rgba(0, 0, 0, 0.55); 
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(251, 191, 36, 0.4); 
      color: #fff;
      padding: 7px 14px; /* ğŸ”¥ ë²„íŠ¼ íŒ¨ë”© ì‚´ì§ ì¶•ì†Œ */
      border-radius: 20px; 
      font-weight: 700; 
      font-size: 13px; /* ğŸ”¥ í°íŠ¸ ì‚´ì§ ì¶•ì†Œ */
      cursor: pointer;
      display: flex; align-items: center; gap: 6px;
      transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.1s;
      position: relative; z-index: 101; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.3); 
    }
    .menu-btn:active { 
      background: rgba(0, 0, 0, 0.7); 
      transform: scale(0.94);
    }

    .menu-dim {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 90;
      backdrop-filter: blur(3px); -webkit-backdrop-filter: blur(3px);
      opacity: 0; visibility: hidden; transition: opacity 0.3s;
    }
    body.menu-open .menu-dim { opacity: 1; visibility: visible; }

    .category-dropdown {
      position: absolute; top: calc(100% + 12px); right: 0;
      width: 240px;
      background: #fff; border-radius: 20px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.25);
      padding: 12px;
      z-index: 100;
      opacity: 0; visibility: hidden; transform: translateY(-10px);
      transition: all 0.3s cubic-bezier(0.32, 0.72, 0, 1);
      transform-origin: top right;
    }
    body.menu-open .category-dropdown {
      opacity: 1; visibility: visible; transform: translateY(0);
    }

    .dropdown-header {
      font-size: 13px; font-weight: 700; color: #94a3b8;
      padding: 4px 8px 10px; 
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 6px;
    }

    .drop-nav button {
      width: 100%; text-align: left; background: none; border: none;
      padding: 10px 8px;
      font-size: 15px; font-weight: 600; color: var(--text-main);
      border-radius: 12px; cursor: pointer; 
      display: flex; align-items: center; gap: 14px; 
      transition: background-color 0.1s, transform 0.1s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .menu-icon {
      width: 32px; 
      height: 32px;
      border-radius: 10px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      flex-shrink: 0; 
      font-size: 16px; 
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.04);
    }

    .drop-nav button span { flex: 1; letter-spacing: -0.3px; }
    
    .drop-nav button:active { 
      background: #f1f5f9; 
      transform: scale(0.96); 
    }

    /* =========================================================
       [5] ë©”ì¸ ì½˜í…ì¸  (í™˜ì˜ë¬¸êµ¬ & DAY ë²„íŠ¼ë“¤)
    ========================================================= */
    .home-main-content {
      position: relative; z-index: 10;
      flex: 1; 
      display: flex; flex-direction: column; justify-content: flex-end; /* í•˜ë‹¨ ì •ë ¬ ìœ ì§€ */
      padding: 0 20px 30px; /* ğŸ”¥ ì¢Œìš° íŒ¨ë”© 24->20, í•˜ë‹¨ íŒ¨ë”© 40->30 ì¶•ì†Œ */
      padding-bottom: max(30px, env(safe-area-inset-bottom)); /* ğŸ”¥ í•˜ë‹¨ ì•ˆì „ì˜ì—­ ê³ ë ¤í•œ íŒ¨ë”© ì¶•ì†Œ */
      color: #fff;
    }
    
    /* ğŸ”¥ í™˜ì˜ ë¬¸êµ¬ ì˜ì—­ ëª¨ë°”ì¼ ìµœì í™” */
    .welcome-text { margin-bottom: 16px; } /* ğŸ”¥ í•˜ë‹¨ ì—¬ë°± ì¶•ì†Œ */
    .welcome-text p { font-size: 16px; margin: 0; opacity: 0.95; font-weight: 500; letter-spacing: -0.5px; } /* ğŸ”¥ í°íŠ¸ 18->16 */
    .welcome-text strong { color: #e6c27a; font-weight: 900; font-size: 18px; letter-spacing: -0.5px; text-shadow: 0 2px 6px rgba(0,0,0,0.4); } /* ğŸ”¥ í°íŠ¸ 20->18 */
    .welcome-text h2 { font-size: 28px; font-weight: 900; margin: 4px 0 8px; line-height: 1.2; letter-spacing: -1px; } /* ğŸ”¥ í°íŠ¸ 32->28, ë§ˆì§„ ì¶•ì†Œ */
    
    .meta-badges { display: flex; align-items: center; gap: 8px; margin-top: 8px; flex-wrap: wrap; }
    .welcome-text .sub-date { display: inline-block; padding: 5px 12px; background: rgba(0,0,0,0.4); border-radius: 20px; font-size: 12px; border: 1px solid rgba(255,255,255,0.1); font-weight: 600; } /* ğŸ”¥ íŒ¨ë”©, í°íŠ¸ ì¶•ì†Œ */

    .weather-badge {
      display: inline-flex; align-items: center; gap: 6px;
      background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15); color: #fff;
      padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; /* ğŸ”¥ íŒ¨ë”©, í°íŠ¸ ì¶•ì†Œ */
      cursor: pointer; transition: transform 0.1s, background 0.1s;
    }
    .weather-badge:active { transform: scale(0.95); background: rgba(0, 0, 0, 0.6); }
    .weather-badge strong { color: #e6c27a; font-size: 13px; font-weight: 800; letter-spacing: -0.3px; }

    /* ğŸ”¥ ë©”ì¸ í™”ë©´ ê³µí•­ ì•ˆë‚´ ë¬¸êµ¬ ì˜ì—­ ìµœì í™” */
    .home-notice {
      display: flex;
      align-items: flex-start;
      gap: 10px; /* ğŸ”¥ ê°­ ì¶•ì†Œ */
      background: rgba(20, 24, 34, 0.55);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(251, 191, 36, 0.4);
      border-radius: 12px; /* ğŸ”¥ ë¼ìš´ë“œ ì‚´ì§ ì¶•ì†Œ */
      padding: 10px 12px; /* ğŸ”¥ íŒ¨ë”© ì¶•ì†Œ */
      margin-bottom: 14px; /* ğŸ”¥ í•˜ë‹¨ ì—¬ë°± ì¶•ì†Œ */
      box-shadow: 0 4px 15px rgba(0,0,0,0.25);
    }
    .home-notice .notice-icon {
      font-size: 18px; /* ğŸ”¥ ì•„ì´ì½˜ í¬ê¸° ì¶•ì†Œ */
      margin-top: 1px;
    }
    .home-notice p {
      margin: 0;
      font-size: 13px; /* ğŸ”¥ í°íŠ¸ ì‚´ì§ ì¶•ì†Œ */
      color: rgba(255, 255, 255, 0.95);
      line-height: 1.4; /* ğŸ”¥ ìê°„ ì¶•ì†Œ */
      font-weight: 500;
      word-break: keep-all;
    }
    .home-notice p strong {
      color: #fde047;
      font-weight: 800;
      text-shadow: 0 1px 3px rgba(0,0,0,0.8);
    }

    .loc-badge {
      display: inline-flex;
      background: rgba(220, 38, 38, 0.15);
      border: 1px solid rgba(220, 38, 38, 0.35);
      color: #fca5a5;
      font-size: 12px; /* ğŸ”¥ í°íŠ¸ ì¶•ì†Œ */
      font-weight: 700;
      padding: 4px 8px; /* ğŸ”¥ íŒ¨ë”© ì¶•ì†Œ */
      border-radius: 6px;
      margin-top: 6px; /* ğŸ”¥ ìœ„ìª½ ë§ˆì§„ ì¶•ì†Œ */
      letter-spacing: -0.3px;
    }
    .loc-badge-flight {
      display: inline-flex;
      background: #fee2e2;
      border: 1px solid #fca5a5;
      color: #991b1b;
      font-size: 12px;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 6px;
      margin-top: 6px;
      letter-spacing: -0.3px;
    }

    /* =========================================================
       ğŸ”¥ğŸ”¥ ëŒ€ë§Œí’ DAY 1~4 ë²„íŠ¼ (ëª¨ë°”ì¼ í™”ë©´ í•íŒ…ì„ ìœ„í•œ ì˜í˜¼ì˜ ì„¸íŒ…)
    ========================================================= */
    .day-buttons {
      display: grid; grid-template-columns: 1fr 1fr; gap: 8px; /* ğŸ”¥ ê°„ê²© 10->8 ì¶•ì†Œ */
    }

    .day-btn {
      background-color: rgba(15, 23, 42, 0.65); 
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      
      background-image: 
        radial-gradient(circle at 90% 10%, rgba(225, 29, 72, 0.35) 0%, transparent 60%),
        radial-gradient(circle at 10% 90%, rgba(251, 191, 36, 0.15) 0%, transparent 50%),
        url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 0l20 20-20 20L0 20z' stroke='rgba(255, 215, 0, 0.05)' fill='none' stroke-width='1'/%3E%3Cpath d='M20 10l10 10-10 10-10-10z' stroke='rgba(255, 215, 0, 0.03)' fill='none' stroke-width='0.5'/%3E%3C/svg%3E");
      
      background-size: cover, cover, 40px 40px;
      
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-top: 1px solid rgba(255, 255, 255, 0.3);
      border-bottom: 1px solid rgba(251, 191, 36, 0.25);
      padding: 12px 10px; /* ğŸ”¥ ìƒí•˜ 14->12, ì¢Œìš° 12->10 íŒ¨ë”© íƒ€ì´íŠ¸í•˜ê²Œ ì¶•ì†Œ */
      border-radius: 14px; /* ğŸ”¥ ë¼ìš´ë“œ ì‚´ì§ ê¹ìŒ */
      color: #fff; text-align: left;
      
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      display: flex; flex-direction: column; justify-content: space-between;
      min-height: 80px; /* ğŸ”¥ ìµœì†Œ ë†’ì´ 90->80 ëŒ€í­ ì¶•ì†Œ (ì´ë˜ì•¼ ì•„ì´í° Safari í•˜ë‹¨ë°” ëŒ€ì‘ë¨) */
      position: relative;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    
    .day-btn-header, .day-btn .day-title { 
      position: relative; 
      z-index: 1; 
      text-shadow: 0 2px 4px rgba(0,0,0,0.8); 
    }

    .day-btn-header { display: flex; justify-content: space-between; align-items: center; width: 100%; font-size: 15px; font-weight: 800; color: #fff; letter-spacing: -0.3px; } /* ğŸ”¥ íƒ€ì´í‹€ í°íŠ¸ 16->15 */
    
    /* ë‚ ì§œ ë°°ì§€ */
    .btn-date { font-size: 10px; font-weight: 700; color: #fde047; background: rgba(0, 0, 0, 0.4); padding: 2px 6px; border-radius: 8px; letter-spacing: 0; border: 1px solid rgba(251, 191, 36, 0.3); box-shadow: inset 0 1px 2px rgba(255,255,255,0.1); backdrop-filter: blur(4px); text-shadow: none; } /* ğŸ”¥ ë°°ì§€ í°íŠ¸/íŒ¨ë”©/ë¼ìš´ë“œ ì¶•ì†Œ */
    
    .day-btn .day-title { font-size: 12.5px; font-weight: 500; color: rgba(255, 255, 255, 0.9); margin-top: 6px; line-height: 1.3; word-break: keep-all; } /* ğŸ”¥ í°íŠ¸/ìƒë‹¨ ì—¬ë°± ì¶•ì†Œ */
    
    .day-btn:active { 
      transform: scale(0.96); 
      background-color: rgba(10, 15, 20, 0.8);
      border-color: rgba(251, 191, 36, 0.6);
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    /* ========================================================= */
    /* =========================================================
       [6] Bottom Sheet (Detail Page)
    ========================================================= */
    #detailPage { position: fixed; inset: 0; z-index: 3000; display: none; }
    .detail-dim { position: absolute; inset: 0; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
    .detail-sheet__inner { position: absolute; bottom: 0; left: 0; right: 0; height: 100%; height: 100dvh; background: var(--bg-main); border-radius: 0; display: flex; flex-direction: column; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1); }
    body.detail-open .detail-dim { opacity: 1; pointer-events: auto; }
    body.detail-open .detail-sheet__inner { transform: translateY(0); }

    .detail-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; background: #fff; padding-top: max(20px, env(safe-area-inset-top)); border-radius: 0; border-bottom: 1px solid var(--border-light); flex-shrink: 0; }
    .detail-title { font-size: 18px; font-weight: 700; color: var(--primary-color); }
    .detail-actions button { background: none; border: none; font-size: 14px; color: var(--text-sub); margin-left: 12px; cursor: pointer; font-weight: 600; }
    #detailContent { flex: 1; overflow-y: auto; padding: 20px 20px calc(20px + var(--safe-bottom)); -webkit-overflow-scrolling: touch; }

    /* =========================================================
       [7] ìƒì„¸ ì»¨í…ì¸  ìŠ¤íƒ€ì¼ (ì¼ì •, í™˜ìœ¨ ë“±)
    ========================================================= */
    .day-card { background: var(--card-bg); border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
    .day-card h3 { margin: 0 0 10px; font-size: 18px; color: var(--primary-color); display: flex; align-items: baseline; gap: 8px; font-weight: 800; }
    .day-card h3 span { font-size: 13px; color: var(--text-sub); font-weight: 500; }
    .day-title { margin: 0 0 20px; font-weight: 600; color: var(--accent-color); font-size: 15px; }

    .timeline { border-left: 2px solid var(--border-light); margin-left: 10px; padding-left: 20px; }
    .schedule-item { position: relative; margin-bottom: 24px; }
    .schedule-item:last-child { margin-bottom: 0; }
    .timeline-dot { position: absolute; left: -26px; top: 0; width: 10px; height: 10px; border-radius: 50%; background: var(--accent-color); border: 2px solid #fff; }
    .schedule-card { display: flex; flex-direction: column; gap: 4px; }
    .schedule-time { font-size: 13px; font-weight: 700; color: var(--text-sub); }
    .schedule-title { font-size: 15px; font-weight: 600; color: var(--text-main); }
    .schedule-desc { font-size: 13px; color: var(--text-sub); margin-top: 4px; line-height: 1.4; }

    /* í™˜ìœ¨, ëŒ€ë§Œì˜ ëª¨ë“  ê²ƒ, ë‚ ì”¨ */
    .country-compare-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
    .country-card { background: var(--card-bg); padding: 18px 12px; border-radius: 16px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.04); }
    .country-header { display: flex; align-items: center; justify-content: center; gap: 6px; margin-bottom: 12px; }
    .flag-img { width: 28px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .country-card h3 { margin: 0; font-size: 15px; font-weight: 800; letter-spacing: -0.5px; color: var(--primary-color); }
    .time-box { background: var(--bg-main); padding: 12px 8px; border-radius: 12px; margin: 12px 0; }
    .time-box .time-label { display: block; font-size: 12px; font-weight: 600; color: var(--text-sub); }
    .time-box strong { display: block; font-size: 17px; color: var(--primary-color); margin-top: 4px; font-weight: 800; font-variant-numeric: tabular-nums; letter-spacing: 0; }
    .country-list { list-style: none; padding: 0; margin: 0; text-align: left; font-size: 13px; }
    .country-list li { display: flex; justify-content: space-between; align-items: center; padding: 8px 2px; border-bottom: 1px solid var(--border-light); }
    .country-list li:last-child { border: none; padding-bottom: 0; }
    .country-list li span { color: var(--text-sub); font-weight: 600; font-size: 12px; white-space: nowrap; }
    .country-list li strong { font-weight: 700; color: var(--text-main); font-size: 13px; white-space: nowrap; text-align: right; letter-spacing: -0.3px; }

    .weather-detail-wrapper { margin-bottom: 20px; }
    .weather-current-row { display: flex; justify-content: space-around; align-items: center; background: var(--card-bg); border-radius: 16px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); margin-bottom: 12px; }
    .w-city { text-align: center; flex: 1; }
    .w-city span { font-size: 12px; color: var(--text-sub); font-weight: 600; display:block; margin-bottom: 4px; }
    .w-city strong { font-size: 20px; font-weight: 800; color: var(--primary-color); display:flex; align-items:center; gap:4px; justify-content:center; }
    .w-vs { color: var(--border-light); font-weight: 300; font-size: 24px; padding: 0 10px; }
    
    .forecast-container { background: var(--card-bg); border-radius: 16px; padding: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); }
    .forecast-header { font-size: 15px; font-weight: 800; margin-bottom: 14px; color: var(--primary-color); display:flex; justify-content:space-between; align-items:center; }
    .forecast-update { font-size: 11px; color: var(--text-sub); font-weight: 500; }
    .forecast-list { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; scrollbar-width: none; }
    .forecast-list::-webkit-scrollbar { display: none; }
    .forecast-item { flex: 0 0 auto; width: 72px; background: var(--bg-main); border-radius: 12px; padding: 12px 4px; text-align: center; border: 1px solid var(--border-light); }
    .f-date { font-size: 12px; color: var(--text-sub); font-weight: 700; display:block; margin-bottom: 6px; letter-spacing:-0.5px;}
    .f-icon { font-size: 22px; margin-bottom: 4px; display:block; }
    .f-temp { font-size: 13px; font-weight: 800; color: #e53e3e; display:block; }
    .f-temp-min { font-size: 12px; color: #3182ce; font-weight: 700; display:block; margin-top:2px; }

    .exchange-row { background: var(--primary-color); color: #fff; padding: 18px 20px; border-radius: 16px; text-align: center; margin-bottom: 16px; box-shadow: 0 4px 12px rgba(26,35,58,0.15); }
    .exchange-row strong { font-size: 18px; font-weight: 800; letter-spacing: -0.5px; }
    .fx-grid { display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: center; margin-top: 16px;}
    .fx-box input { width: 100%; padding: 12px; border: 1px solid var(--border-light); border-radius: 10px; text-align: right; font-weight: 600; font-size: 16px; }
    .fx-eq { font-size: 20px; color: var(--text-sub); }

    /* ğŸ”¥ [ìˆ˜ì •] 2. ì„ íƒê´€ê´‘ ì‚¬ì§„í˜• ì¹´ë“œ CSS ê°œì„  */
    .tour-card-photo { position: relative; border-radius: 20px; overflow: hidden; margin-bottom: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); background-color: #000; height: 240px; color: #fff; }
    .tour-card-bg { position: absolute; inset: 0; background-size: cover; background-position: center; transition: transform 0.4s; }
    .tour-card-photo:active .tour-card-bg { transform: scale(1.05); }
    .tour-card-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.1) 40%, rgba(0,0,0,0.5) 100%); }
    .tour-info { position: absolute; inset: 0; z-index: 2; padding: 20px; display: flex; flex-direction: column; align-items: flex-start; }
    .tour-badge { display: inline-block; background: var(--accent-color); color: #fff; font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 100px; margin-bottom: 8px; text-transform: uppercase; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .tour-badge.red { background: #e53e3e; } 
    .tour-info h3 { margin: 0 0 6px; font-size: 22px; font-weight: 800; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    .tour-desc { font-size: 13px; opacity: 0.9; margin: 0; line-height: 1.4; text-shadow: 0 1px 3px rgba(0,0,0,0.5); }
    .tour-meta-box { margin-top: auto; width: 100%; background: rgba(255,255,255,0.15); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px); border-radius: 12px; padding: 10px 14px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
    .tour-meta-items { display: flex; gap: 8px; font-size: 12px; }
    .tour-meta-items span { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; }

    /* âœ… ì¤‘ì‹ë¹„ ìƒíƒœ ìƒ‰ìƒ CSS ì¶”ê°€ */
    .status.pending { color: #ff4d4f; font-weight: 700; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
    .status.done { color: #22c55e; font-weight: 700; text-shadow: 0 1px 2px rgba(0,0,0,0.5); }
    .meal-status-btn { background: #fff; color: #1a233a; border: none; font-size: 12px; font-weight: 700; padding: 6px 12px; border-radius: 8px; }
    .meal-status-btn.done { background: #38a169; color: #fff; }

    #requestInput { width: 100%; height: 120px; padding: 16px; border: 1px solid var(--border-light); border-radius: 12px; resize: none; font-size: 15px; margin-bottom: 12px; }

    /* ğŸ”¥ í•„ìˆ˜ ì—¬í–‰ íšŒí™” CSS */
    .conv-category {
      background: var(--card-bg);
      border-radius: 16px;
      margin-bottom: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.04);
      border: 1px solid var(--border-light);
      overflow: hidden;
    }
    .conv-header {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 16px;
      font-weight: 800;
      color: var(--primary-color);
      cursor: pointer;
      background: #fff;
      transition: background 0.2s;
    }
    .conv-header:active { background: #f8fafc; }
    .conv-header-left { display: flex; align-items: center; gap: 10px; }
    .conv-icon-bg {
      background: #f1f5f9; width: 32px; height: 32px; border-radius: 10px; 
      display: flex; align-items: center; justify-content: center; font-size: 16px; 
    }
    .conv-header svg { transition: transform 0.3s; width: 20px; height: 20px; stroke: #94a3b8; }
    .conv-category.open .conv-header svg { transform: rotate(180deg); }
    .conv-list {
      display: none;
      padding: 0 20px 10px;
      background: #fff;
    }
    .conv-category.open .conv-list {
      display: block;
    }
    .conv-item {
      padding: 16px 0;
      border-top: 1px dashed var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }
    .conv-text-box { flex: 1; }
    .conv-ko { font-size: 13px; font-weight: 700; color: var(--text-sub); margin-bottom: 6px; }
    .conv-cn { font-size: 22px; font-weight: 900; color: var(--primary-color); margin-bottom: 8px; letter-spacing: 0.5px; }
    .conv-pr-box { display: flex; align-items: center; gap: 8px; }
    .conv-pr-badge { background: #dcfce7; color: #15803d; font-size: 11px; font-weight: 800; padding: 2px 6px; border-radius: 6px; }
    .conv-pr { font-size: 14px; font-weight: 800; color: #16a34a; letter-spacing: -0.3px;}
    .conv-copy-btn {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      color: #64748b;
      font-size: 13px;
      font-weight: 700;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.1s, background 0.1s;
      white-space: nowrap;
    }
    .conv-copy-btn:active { background: #e2e8f0; transform: scale(0.95); }
    .conv-copy-btn svg { width: 14px; height: 14px; }


    /* =========================================================
       [8] ë°ìŠ¤í¬íƒ‘ (PC) ëŒ€ì‘
    ========================================================= */
    @media (min-width: 768px) {
      .home-main-content { max-width: 1000px; margin: 0 auto; width: 100%; padding-bottom: 80px; }
      .home-header { max-width: 1000px; margin: 0 auto; width: 100%; padding-top: 30px; }
      .welcome-text h2 { font-size: 48px; }
      .welcome-text p { font-size: 20px; }
      .day-buttons { grid-template-columns: repeat(4, 1fr); gap: 16px; }
      .day-btn { min-height: 120px; padding: 20px; }
      .day-btn-header { font-size: 20px; }
      .day-btn .day-title { font-size: 15px; margin-top: 16px; }
      
      .category-dropdown { width: 240px; padding: 12px; }
      .drop-nav button { font-size: 16px; padding: 12px 10px; }

      .detail-sheet__inner {
        top: 50%; left: 50%; bottom: auto; right: auto;
        transform: translate(-50%, -48%) scale(0.95); 
        width: 100%; max-width: 600px; height: 85vh; max-height: 800px; 
        border-radius: 24px; opacity: 0;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
        transition: transform 0.4s cubic-bezier(0.32, 0.72, 0, 1), opacity 0.4s;
      }
      body.detail-open .detail-sheet__inner { transform: translate(-50%, -50%) scale(1); opacity: 1; }
      .detail-header { padding: 24px; padding-top: 24px; border-radius: 24px 24px 0 0; }
      #detailContent { padding: 24px 24px 40px; }
      .country-compare-grid { gap: 20px; }
      .tour-card-photo { height: 320px; } 
      .fx-box input { padding: 16px; font-size: 18px; }
    }

    /* ğŸ”¥ [ì¶”ê°€] 9. QR ë¡œê·¸ì¸ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ (ëŒ€ë§Œ í’ë“± & ì¹´ë£¡ì´ ë“œë¡œì‰) CSS */
    .lantern-loading {
      position: fixed; inset: 0; z-index: 99999;
      display: none; align-items: center; justify-content: center;
      background: linear-gradient(to top, #0f172a, #000000); /* ëŒ€ë§Œ ì•¼ê²½ ë°¤í•˜ëŠ˜ ëŠë‚Œ (ê¸€ê·€ ì œê±°) */
      transition: opacity 0.5s ease-out; /* ë¶€ë“œëŸ½ê²Œ ì‚¬ë¼ì§€ê¸° ìœ„í•¨ */
    }
    .lanterns-wrapper {
      position: absolute; inset: 0; overflow: hidden; pointer-events: none;
    }
    .lantern {
      position: absolute; bottom: -100px;
      animation: floatUp 2.5s ease-in forwards;
      opacity: 0;
      filter: drop-shadow(0 0 12px rgba(255, 120, 0, 0.8));
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    @keyframes floatUp {
      0% { transform: translateY(0) rotate(-5deg); opacity: 0; }
      15% { opacity: 1; }
      100% { transform: translateY(-120vh) rotate(5deg); opacity: 0; }
    }

    /* ğŸ”¥ ì¹´ë£¡ì´ê°€ ë§¤ë‹¬ë ¤ ë‹¬ë‘ê±°ë¦¬ëŠ” ì¤„ê³¼ ë˜í¼ ì• ë‹ˆë©”ì´ì…˜ */
    .karyong-string {
      width: 2px;
      height: 12px;
      background: rgba(255, 255, 255, 0.6);
      margin-top: -5px; /* í’ë“± ë°”ë¡œ ë°‘ì—ì„œ ì‹œì‘ë˜ë„ë¡ */
      z-index: 2;
    }
    .karyong-wrap {
      animation: swing 1.8s ease-in-out infinite alternate;
      transform-origin: top center;
      margin-top: -2px;
      z-index: 10;
    }
    @keyframes swing {
      0% { transform: rotate(-12deg); }
      100% { transform: rotate(12deg); }
    }
  </style>
</head>

<body>

<!-- ğŸ”¥ [ì¶”ê°€] í’ì„±í•œ í’ë“± & ì¹´ë£¡ì´(CSS ë“œë¡œì‰) ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ ë§ˆí¬ì—… -->
<div id="lanternLoading" class="lantern-loading">
  <div class="lanterns-wrapper">
    <!-- ë°°ê²½ì„ ì±„ì›Œì¤„ ë‹¤ì–‘í•œ í¬ê¸°ì™€ ë”œë ˆì´ë¥¼ ê°€ì§„ í’ë“± 14ê°œ -->
    <span class="lantern" style="left: 10%; animation-delay: 0.2s; font-size: 30px;">ğŸ®</span>
    <span class="lantern" style="left: 25%; animation-delay: 0.7s; font-size: 45px;">ğŸ®</span>
    <span class="lantern" style="left: 40%; animation-delay: 0.1s; font-size: 25px;">ğŸ®</span>
    <span class="lantern" style="left: 65%; animation-delay: 0.8s; font-size: 35px;">ğŸ®</span>
    <span class="lantern" style="left: 80%; animation-delay: 0.4s; font-size: 40px;">ğŸ®</span>
    <span class="lantern" style="left: 90%; animation-delay: 0.9s; font-size: 28px;">ğŸ®</span>
    <span class="lantern" style="left: 5%; animation-delay: 1.1s; font-size: 33px;">ğŸ®</span>
    <span class="lantern" style="left: 20%; animation-delay: 0.6s; font-size: 48px;">ğŸ®</span>
    <span class="lantern" style="left: 35%; animation-delay: 1.2s; font-size: 22px;">ğŸ®</span>
    <span class="lantern" style="left: 55%; animation-delay: 1.0s; font-size: 38px;">ğŸ®</span>
    <span class="lantern" style="left: 70%; animation-delay: 0.5s; font-size: 50px;">ğŸ®</span>
    <span class="lantern" style="left: 85%; animation-delay: 1.3s; font-size: 30px;">ğŸ®</span>
    <span class="lantern" style="left: 15%; animation-delay: 1.4s; font-size: 26px;">ğŸ®</span>
    <span class="lantern" style="left: 95%; animation-delay: 0.2s; font-size: 42px;">ğŸ®</span>

    <!-- ğŸ”¥ í¬ì¸íŠ¸: ì¹´ë£¡ì´(Inline SVG)ê°€ ë‹¬ë‘ê±°ë¦¬ë©° ë§¤ë‹¬ë ¤ìˆëŠ” íŠ¹ë³„í•œ ë©”ì¸ ì¤‘ì•™ í’ë“± -->
    <div class="lantern" style="left: 50%; animation-delay: 0.1s; font-size: 65px; z-index: 100; animation-duration: 2.8s;">
      ğŸ®
      <div class="karyong-string"></div>
      <div class="karyong-wrap">
        <!-- ğŸ¨ ì§ì ‘ ê·¸ë¦° ì¹´ë£¡ì´ (í•˜ì–€ ìˆ˜ì—¼, íŒŒë€ ëª¸, ì›ƒëŠ” í‘œì •) -->
        <svg viewBox="0 0 100 120" width="55" height="65" style="filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5)); transform: translateY(-5px);">
          <!-- ì¤„ê³¼ ì´ì–´ì§€ëŠ” ë’¤ìª½ íŒ” -->
          <path d="M 35 65 Q 20 30 45 35" fill="none" stroke="#1E3A8A" stroke-width="12" stroke-linecap="round"/>
          <path d="M 35 65 Q 20 30 45 35" fill="none" stroke="#5DB3F0" stroke-width="6" stroke-linecap="round"/>
          
          <!-- í†µí†µí•œ ê¼¬ë¦¬ -->
          <path d="M 70 80 Q 100 90 95 60 Q 80 75 65 75" fill="#5DB3F0" stroke="#1E3A8A" stroke-width="3" stroke-linejoin="round" stroke-linecap="round"/>

          <!-- ë‹¤ë¦¬ ë‘ ê°œ -->
          <rect x="35" y="85" width="12" height="15" rx="6" fill="#5DB3F0" stroke="#1E3A8A" stroke-width="3"/>
          <rect x="53" y="85" width="12" height="15" rx="6" fill="#5DB3F0" stroke="#1E3A8A" stroke-width="3"/>

          <!-- íŒŒë€ìƒ‰ ëª¸í†µ -->
          <rect x="25" y="45" width="50" height="50" rx="20" fill="#5DB3F0" stroke="#1E3A8A" stroke-width="3"/>
          <!-- í•˜ì–€ ë°° -->
          <rect x="32" y="55" width="36" height="35" rx="15" fill="#D6F0FF"/>

          <!-- ì•ìª½ íŒ” (í’ë“± ì¤„ì„ ì¡ì€ ëª¨ìŠµ) -->
          <path d="M 65 65 Q 80 30 55 35" fill="none" stroke="#1E3A8A" stroke-width="12" stroke-linecap="round"/>
          <path d="M 65 65 Q 80 30 55 35" fill="none" stroke="#5DB3F0" stroke-width="6" stroke-linecap="round"/>

          <!-- ë¨¸ë¦¬ ìœ„ ë¿”/ëŒê¸° -->
          <path d="M 25 35 L 15 25 L 30 20 Z" fill="#5DB3F0" stroke="#1E3A8A" stroke-width="3" stroke-linejoin="round"/>
          <path d="M 75 35 L 85 25 L 70 20 Z" fill="#5DB3F0" stroke="#1E3A8A" stroke-width="3" stroke-linejoin="round"/>

          <!-- ë™ê·¸ë€ ë¨¸ë¦¬ -->
          <ellipse cx="50" cy="35" rx="32" ry="26" fill="#5DB3F0" stroke="#1E3A8A" stroke-width="3"/>

          <!-- ì›ƒëŠ” ëˆˆ (^ ^) -->
          <path d="M 36 32 Q 40 26 44 32" fill="none" stroke="#1E3A8A" stroke-width="3" stroke-linecap="round"/>
          <path d="M 56 32 Q 60 26 64 32" fill="none" stroke="#1E3A8A" stroke-width="3" stroke-linecap="round"/>

          <!-- í™œì§ ì›ƒëŠ” ì… -->
          <path d="M 40 40 Q 50 55 60 40 Z" fill="#FF7B9C" stroke="#1E3A8A" stroke-width="2" stroke-linejoin="round"/>
          
          <!-- â­ï¸ ì¹´ë£¡ì´ì˜ í•µì‹¬ í¬ì¸íŠ¸: ì–‘ë³¼ì˜ ë¾°ì¡±í•œ í•˜ì–€ ìˆ˜ì—¼ -->
          <path d="M 32 40 C 15 45 5 25 15 35 C 20 45 25 45 32 45 Z" fill="#FFFFFF" stroke="#1E3A8A" stroke-width="2" stroke-linejoin="round"/>
          <path d="M 68 40 C 85 45 95 25 85 35 C 80 45 75 45 68 45 Z" fill="#FFFFFF" stroke="#1E3A8A" stroke-width="2" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>
  </div>
</div>

<!-- ğŸš€ [ì¶”ê°€] QR ë¡œê·¸ì¸ ì‹œ ì°°ë‚˜ì˜ ë¡œê·¸ì¸ í™”ë©´ ê¹œë¹¡ì„ ì™„ë²½ ì°¨ë‹¨ìš© ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  if (new URLSearchParams(window.location.search).get("eid")) {
    // URLì— ì‚¬ë²ˆì´ ìˆìœ¼ë©´ ë¡œë”©ì°½ ì¦‰ì‹œ ë…¸ì¶œ
    document.getElementById("lanternLoading").style.display = "flex";
    // ê¸°ë³¸ ë¡œê·¸ì¸ í™”ë©´ì„ ë Œë”ë§ ìµœìš°ì„  ìˆœìœ„ë¡œ ìˆ¨ê²¨ë²„ë¦¼ (ì°°ë‚˜ì˜ ê¹œë¹¡ì„ ë°©ì§€)
    const hideStyle = document.createElement('style');
    hideStyle.id = "hideLoginTemp";
    hideStyle.innerHTML = '#loginSection { visibility: hidden !important; }';
    document.head.appendChild(hideStyle);
  }
</script>

<!-- ================= LOGIN ================= -->
<section id="loginSection" class="login-hero">
  <div class="hero-overlay">
    <div class="login-box">
      <!-- ğŸ”¥ [ìˆ˜ì •] ë‚´ì¥ ë°ì´í„° ì œê±°í•˜ê³  ë¡œì»¬ ê²½ë¡œ ë³µì› -->
      <img src="assets/images/logo.png" class="hero-logo" onerror="this.style.display='none'">
      <h2>2025 ISC Taiwan</h2>
      <p class="hero-desc">ì‚¬ë²ˆìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”</p>

      <input type="text" id="employeeId" placeholder="ì‚¬ë²ˆ ì…ë ¥">
      <button class="primary-btn" onclick="login()">ë¡œê·¸ì¸</button>
      <p id="loginError" class="error"></p>
    </div>
  </div>
</section>

<!-- ================= MAIN ================= -->
<main id="mainSection" class="main-bg" style="display:none;">

  <!-- ================= HOME VIEW ================= -->
  <section id="homeView" class="home-view">
    <div class="home-overlay"></div>
    
    <!-- ë©”ë‰´ ì—´ë¦´ ë•Œ ì „ì²´ í™”ë©´ì„ ì‚´ì§ ì–´ë‘¡ê²Œ í•´ì£¼ëŠ” ë”¤ -->
    <div id="menuDim" class="menu-dim" onclick="toggleMenu()"></div>
    
    <!-- 1ï¸âƒ£ ìƒë‹¨ í—¤ë” & ë©”ë‰´ ë²„íŠ¼ -->
    <header class="home-header">
      <img src="assets/images/logo.png" class="header-logo" alt="INCAR Logo">
      
      <!-- ìš°ì¸¡ ìƒë‹¨ ì¹´í…Œê³ ë¦¬ ë¬¶ìŒ -->
      <div class="menu-wrapper">
        <button class="menu-btn" onclick="toggleMenu()">â˜° ì—¬í–‰ì •ë³´</button>
        
        <!-- ë“œë¡­ë‹¤ìš´ íŒì—… ë©”ë‰´ -->
        <div id="categoryDropdown" class="category-dropdown">
          <div class="dropdown-header">ë©”ë‰´</div>
          <nav class="drop-nav">
            <!-- 1. ëŒ€ë§Œì˜ ëª¨ë“  ê²ƒ -->
            <button onclick="openPage('taiwan')">
              <div class="menu-icon" style="background: #fee2e2;">ğŸ‡¹ğŸ‡¼</div>
              <span>ëŒ€ë§Œì˜ ëª¨ë“  ê²ƒ</span>
            </button>
            
            <!-- 2. í™˜ìœ¨ ê³„ì‚°ê¸° -->
            <button onclick="openPage('exchange')">
              <div class="menu-icon" style="background: #dcfce7;">ğŸ’±</div>
              <span>í™˜ìœ¨ ê³„ì‚°ê¸°</span>
            </button>  
            
            <!-- 3. í•­ê³µí¸ ì •ë³´ -->
            <button onclick="openPage('flight')">
              <div class="menu-icon" style="background: #e0e7ff;">âœˆï¸</div>
              <span>í•­ê³µí¸ ì •ë³´</span>
            </button>
            
            <!-- 4. ë‚˜ì˜ ì„ íƒ ê´€ê´‘ -->
            <button onclick="openPage('myTour')">
              <div class="menu-icon" style="background: #fce7f3;">ğŸ’</div>
              <span>ë‚˜ì˜ ì„ íƒ ê´€ê´‘</span>
            </button>

            <!-- 6. í•„ìˆ˜ ì—¬í–‰ íšŒí™” -->
            <button onclick="openPage('conversation')">
              <div class="menu-icon" style="background: #d1fae5;">ğŸ’¬</div>
              <span>í•„ìˆ˜ ì—¬í–‰ íšŒí™”</span>
            </button>
            
            <!-- 8. ê¸´ê¸‰ ì—°ë½ë§ -->
            <button onclick="openPage('contact')">
              <div class="menu-icon" style="background: #ffe4e6;">ğŸ“</div>
              <span>ê¸´ê¸‰ ì—°ë½ë§</span>
            </button>
            
            <!-- 9. ë¡œê·¸ì•„ì›ƒ -->
            <button onclick="logout()" style="border-top:1px solid #eee; margin-top:6px; padding-top:12px;">
              <div class="menu-icon" style="background: #f1f5f9;">ğŸšª</div>
              <span style="color: #ef4444;">ë¡œê·¸ì•„ì›ƒ</span>
            </button>
          </nav>
        </div>
      </div>
    </header>

    <!-- 2ï¸âƒ£ ë©”ì¸ ì¤‘ì•™ ì˜ì—­ (í™˜ì˜ ë¬¸êµ¬ + DAY ë²„íŠ¼) -->
    <div class="home-main-content">
      <div class="welcome-text">
        <p><strong id="employeeName"></strong> ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤</p>
        <h2>ISC Taiwan<br>ì—¬ì •ì˜ ì‹œì‘</h2>
        
        <div class="meta-badges">
          <span class="sub-date">2026.03.11 ~ 03.14</span>
          <!-- í´ë¦­ ì‹œ ëŒ€ë§Œì˜ ëª¨ë“  ê²ƒ(taiwan) í˜ì´ì§€ë¡œ ì´ë™ -->
          <button class="weather-badge" onclick="openPage('taiwan')" id="homeWeather">
            â³ ë‚ ì”¨ ì—°ë™ì¤‘...
          </button>
        </div>
      </div>

      <!-- ğŸ”¥ ë©”ì¸ í™ˆ í™”ë©´ ê³µí•­ ì•ˆë‚´ ë¬¸êµ¬ (ë¡œê·¸ì¸ í›„ JSì—ì„œ ë‚´ìš© ì±„ì›Œì§) -->
      <div class="home-notice" style="align-items: flex-start;">
        <span class="notice-icon" style="margin-top: 2px;">â°</span>
        <div style="width: 100%;">
          <p>ì›í™œí•œ ì¶œêµ­ ìˆ˜ì†ì„ ìœ„í•´ ë°˜ë“œì‹œ <strong style="color: #fde047;">ì¶œë°œ 3ì‹œê°„ ì „</strong>ê¹Œì§€ ê³µí•­ì— ë„ì°©í•´ ì£¼ì„¸ìš”!</p>
          <div id="dynamicHomeMeeting">
            <!-- JSê°€ ì´ ìœ„ì¹˜ì— ë§ì¶¤ ë¯¸íŒ… ì¥ì†Œ ì¹´ë“œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>

      <div class="day-buttons">
        <button class="day-btn" onclick="openPage('day_0')">
          <div class="day-btn-header">DAY 1 <span class="btn-date">03.11</span></div>
          <span class="day-title">ì„¤ë ˆëŠ” ì‹œì‘,<br>íƒ€ì´ë² ì´</span>
        </button>
        <button class="day-btn" onclick="openPage('day_1')">
          <div class="day-btn-header">DAY 2 <span class="btn-date">03.12</span></div>
          <span class="day-title">íë§ê³¼ í™”í•©ì˜ ë°¤,<br>ISC ê³µì‹ ë§Œì°¬</span>
        </button>
        <button class="day-btn" onclick="openPage('day_2')">
          <div class="day-btn-header">DAY 3 <span class="btn-date">03.13</span></div>
          <span class="day-title">ëŒ€ë§Œì˜ ìì—°ê³¼ ë‚­ë§Œ<br></span>
        </button>
        <button class="day-btn" onclick="openPage('day_3')">
          <div class="day-btn-header">DAY 4 <span class="btn-date">03.14</span></div>
          <span class="day-title">êµ¿ë°”ì´,<br>íƒ€ì´ë² ì´</span>
        </button>
      </div>
    </div>
  </section>

<!-- ================= DETAIL OVERLAY ================= -->
<section id="detailPage" class="detail-sheet">
  <div class="detail-dim" onclick="goHome()"></div>

  <div class="detail-sheet__inner" onclick="event.stopPropagation()">
      <div class="detail-header">
        <div class="detail-title" id="detailTitle"></div>
        <div class="detail-actions">
          <button class="btn-home" onclick="goHome()">í™ˆìœ¼ë¡œ</button>
          <button class="btn-back" onclick="goBack()">ë’¤ë¡œê°€ê¸°</button>
        </div>
      </div>
    <div id="detailContent"></div>
  </div>
</section>

</main>

<script>
/* ================= ê³µí†µ ================= */
let pageHistory = [];
let employees = [];
let currentUser = null;
const ADMIN_PASSWORD = "0000";

    
function toggleMenu() {
  document.body.classList.toggle('menu-open');
}

const myTourTemplates = [
  { 
    keyword: "í‹°ì—”ë¼ì´", 
    html: `
      <div class="tour-card-photo">
        <div class="tour-card-bg" style="background-image: url('assets/images/tour_tienlai.jpg');" onerror="this.style.backgroundImage='url(https://images.unsplash.com/photo-1596483582098-9642e12e84d4?auto=format&fit=crop&w=800&q=80)'"></div>
        <div class="tour-card-overlay"></div>
        <div class="tour-info">
          <span class="tour-badge">ì„ íƒ 1ì•ˆ</span>
          <h3>í‹°ì—”ë¼ì´ ì˜¨ì²œ íë§</h3>
          <p class="tour-desc">í‹°ì—”ë¼ì´ ì˜¨ì²œìš• & ì–‘ëª…ì‚° êµ­ë¦½ê³µì› ìë½ì˜ ìµœê³ ê¸‰ ìœ í™© ì˜¨ì²œ</p>
          <div class="tour-meta-box">
            <div class="tour-meta-items">
              <span>ğŸ« ì…ì¥ê¶Œ</span>
              <span>ğŸšŒ ì „ìš©ì°¨ëŸ‰</span>
              <span>ğŸ½ ì¤‘ì‹(ë² ì´ì§•ë•)</span>
            </div>
          </div>
        </div>
      </div>` 
  },
  { 
    keyword: "ê³ ê¶ë°•ë¬¼ê´€", 
    html: `
      <div class="tour-card-photo">
        <div class="tour-card-bg" style="background-image: url('assets/images/tour_museum.jpg');" onerror="this.style.backgroundImage='url(https://images.unsplash.com/photo-1590059390231-fb264f3d47fb?auto=format&fit=crop&w=800&q=80)'"></div>
        <div class="tour-card-overlay"></div>
        <div class="tour-info">
          <span class="tour-badge">ì„ íƒ 2ì•ˆ</span>
          <h3>ê³ ê¶ë°•ë¬¼ê´€ ì—­ì‚¬ ê¸°í–‰</h3>
          <p class="tour-desc">ì¤‘êµ­ ì—­ì‚¬ì˜ ì •ìˆ˜, ëŒ€ë§Œ ê³ ê¶ë°•ë¬¼ê´€ ê´€ëŒ</p>
          <div class="tour-meta-box">
            <div class="tour-meta-items">
              <span>ğŸ« ì…ì¥ê¶Œ</span>
              <span>ğŸšŒ ì „ìš©ì°¨ëŸ‰</span>
              <span>ğŸ½ ì¤‘ì‹(ë² ì´ì§•ë•)</span>
            </div>
          </div>
        </div>
      </div>` 
  },
  { 
    keyword: "ììœ ì¼ì •", 
    html: `
      <div class="tour-card-photo">
        <div class="tour-card-bg" style="background-image: url('assets/images/tour_free.jpg');" onerror="this.style.backgroundImage='url(https://images.unsplash.com/photo-1470004914212-05527e49370b?auto=format&fit=crop&w=800&q=80)'"></div>
        <div class="tour-card-overlay"></div>
        <div class="tour-info">
          <span class="tour-badge red">ì„ íƒ 3ì•ˆ</span>
          <h3>ììœ ë¡œìš´ ëŒ€ë§Œ ì—¬í–‰</h3>
          <p class="tour-desc">ììœ ì¼ì • ëŒ€ë§Œ (ì¤‘ì‹ë¹„ ì§€ê¸‰)</p>
          <div class="tour-meta-box">
             <div class="meal-check" data-tour="ììœ ì¼ì •" style="width:100%; display:flex; justify-content:space-between; align-items:center;">
                <span class="status pending">ì¤‘ì‹ë¹„ ë¯¸ì§€ê¸‰</span>
                <button class="meal-status-btn" onclick="handleMealClick(this)">ì§€ê¸‰ í™•ì¸</button>
             </div>
          </div>
        </div>
      </div>` 
  }
];

function renderMyTour() {
  const selected = currentUser.myTour || [];
  const matchedCards = myTourTemplates.filter(t => selected.some(input => input.includes(t.keyword)));
  if (matchedCards.length === 0) return `<div class="card">ì„ íƒëœ ê´€ê´‘ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
  return matchedCards.map(t => t.html).join("");
}

fetch("people/employees.json?ts=" + Date.now())
  .then(res => res.json())
  .then(data => {
    employees = data;
    tryAutoLogin(); 
  })
  .catch(err => {
    console.warn("ë¡œì»¬ JSON ë¡œë“œ ì‹¤íŒ¨, ë‚´ì¥ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.");
    // ì›ë˜ ìˆë˜ ë¡œì§ëŒ€ë¡œ ì˜ˆë¹„ ë°ì´í„° ì²˜ë¦¬ (ë°ì´í„°ê°€ ìˆë‹¤ë©´)
    if(typeof EMBEDDED_EMPLOYEES !== 'undefined') {
        employees = EMBEDDED_EMPLOYEES;
    }
    tryAutoLogin();
  });

function handleMealClick(btn) {
  const wrap = btn.closest(".meal-check");
  const tour = wrap.dataset.tour;
  const isDone = wrap.classList.contains("done");
  if (isDone) showMealDetail(wrap);
  else approveMeal(wrap, tour);
}

function approveMeal(wrap, tour) {
  const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
  if (pw !== ADMIN_PASSWORD) { alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); return; }
  const time = nowKSTString();
  setMealUI(wrap, "DONE", time);
  saveMealPaid(currentUser.id, tour, time);
  logMealPaymentToSheet({ action: "APPROVE", tour, time });
}

function setMealUI(wrap, mode, time = "") {
  const status = wrap.querySelector(".status");
  const btn = wrap.querySelector("button");
  if (mode === "DONE") {
    wrap.classList.add("done");
    status.textContent = "ì§€ê¸‰ ì™„ë£Œ";
    status.classList.remove("pending"); status.classList.add("done");
    wrap.dataset.time = time; btn.textContent = "ì§€ê¸‰ í™•ì¸";
  } else {
    wrap.classList.remove("done");
    status.textContent = "ì¤‘ì‹ë¹„ ë¯¸ì§€ê¸‰";
    status.classList.add("pending"); status.classList.remove("done");
    wrap.dataset.time = ""; btn.textContent = "ì§€ê¸‰ í™•ì¸";
  }
}
    
function mealKey(userId, tour) { return `mealPaid_${userId}_${tour}`; }
function saveMealPaid(userId, tour, time) { localStorage.setItem(mealKey(userId, tour), JSON.stringify({ time })); }
function loadMealPaid(userId, tour) { const raw = localStorage.getItem(mealKey(userId, tour)); return raw ? JSON.parse(raw) : null; }
function removeMealPaid(userId, tour) { localStorage.removeItem(mealKey(userId, tour)); }

function showMealDetail(wrap) {
  const time = wrap.dataset.time;
  const pw = prompt(`ì§€ê¸‰ ì™„ë£Œ ì‹œê°\n${time}\n\nì·¨ì†Œí•˜ë ¤ë©´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥\n(í™•ì¸ë§Œ ë³´ë ¤ë©´ ì·¨ì†Œ)`);
  if (!pw) return;
  if (pw !== ADMIN_PASSWORD) { alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜"); return; }
  if (confirm("ì§€ê¸‰ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
    const tour = wrap.dataset.tour;
    const cancelTime = nowKSTString();
    setMealUI(wrap, "PENDING");
    removeMealPaid(currentUser.id, tour);
    logMealPaymentToSheet({ action: "CANCEL", tour, time: cancelTime });
  }
}

function nowKSTString() {
  return new Intl.DateTimeFormat("ko-KR", { timeZone: "Asia/Seoul", year: "numeric", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit", second: "2-digit" }).format(new Date());
}

const MEAL_SHEET_URL = "https://script.google.com/macros/s/AKfycbx2tVkT00Z8uXQWl6EeTIUUhZ3_NJHx3JDqSCHC5oJWkUCm0OtcTmaV6g20cNKoh0no9w/exec";

function logMealPaymentToSheet(payload) {
  if (!currentUser) return;
  fetch(MEAL_SHEET_URL, {
    method: "POST", mode: "no-cors",
    body: JSON.stringify({ type: "meal", id: currentUser.id, name: currentUser.name, action: payload.action, tour: payload.tour, time: payload.time })
  }).catch(console.error);
}

function getWeatherEmoji(code) {
  if (code === 0) return "â˜€ï¸"; 
  if (code >= 1 && code <= 3) return "â›…"; 
  if (code >= 45 && code <= 48) return "ğŸŒ«ï¸"; 
  if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) return "ğŸŒ§ï¸"; 
  if (code >= 71 && code <= 77) return "â„ï¸"; 
  if (code >= 85 && code <= 86) return "â„ï¸"; 
  if (code >= 95 && code <= 99) return "â›ˆï¸"; 
  return "â˜ï¸";
}

async function fetchTaipeiWeather() {
  try {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=25.0330&longitude=121.5654&current=temperature_2m,weather_code&timezone=Asia%2FTaipei&_t=${Date.now()}`;
    const res = await fetch(url, { cache: "no-store" });
    const data = await res.json();
    const temp = Math.round(data.current.temperature_2m);
    const code = data.current.weather_code;
    const icon = getWeatherEmoji(code);

    const badge = document.getElementById("homeWeather");
    if (badge) badge.innerHTML = `${icon} íƒ€ì´ë² ì´ <strong>${temp}Â°C</strong>`;
  } catch(e) {
    console.error("ë‚ ì”¨ ì •ë³´ ì—°ë™ ì‹¤íŒ¨", e);
    const badge = document.getElementById("homeWeather");
    if (badge) badge.innerHTML = `â˜ï¸ ë‚ ì”¨ ì •ë³´ ì—†ìŒ`;
  }
}

async function renderDetailedWeather() {
  try {
    const resSeoul = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=37.5665&longitude=126.9780&current=temperature_2m,weather_code&timezone=Asia%2FSeoul&_t=${Date.now()}`, { cache: "no-store" });
    const dataSeoul = await resSeoul.json();
    const seoulTemp = Math.round(dataSeoul.current.temperature_2m);
    const seoulIcon = getWeatherEmoji(dataSeoul.current.weather_code);
    
    const resTaipei = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=25.0330&longitude=121.5654&current=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTaipei&forecast_days=5&_t=${Date.now()}`, { cache: "no-store" });
    const dataTaipei = await resTaipei.json();
    const taipeiTemp = Math.round(dataTaipei.current.temperature_2m);
    const taipeiIcon = getWeatherEmoji(dataTaipei.current.weather_code);

    const elSeoul = document.getElementById("seoulTempDetail");
    const elTaipei = document.getElementById("taipeiTempDetail");
    const elUpdate = document.getElementById("weatherUpdateTime");
    
    if(elSeoul) elSeoul.innerHTML = `${seoulIcon} ${seoulTemp}Â°C`;
    if(elTaipei) elTaipei.innerHTML = `${taipeiIcon} ${taipeiTemp}Â°C`;
    
    const now = new Date();
    const timeStr = new Intl.DateTimeFormat("ko-KR", { hour: "2-digit", minute: "2-digit", second: "2-digit" }).format(now);
    if(elUpdate) elUpdate.textContent = `ì˜¤ëŠ˜ ${timeStr} ê¸°ì¤€`;

    const daily = dataTaipei.daily;
    const forecastHtml = daily.time.slice(0, 5).map((dateStr, idx) => {
      const parts = dateStr.split("-");
      const d = new Date(parts[0], parts[1] - 1, parts[2]);
      
      const days = ["ì¼", "ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† "];
      const isToday = (idx === 0);
      
      const dateTxt = isToday ? "ì˜¤ëŠ˜" : `${d.getMonth()+1}.${d.getDate()} (${days[d.getDay()]})`;
      
      const max = Math.round(daily.temperature_2m_max[idx]);
      const min = Math.round(daily.temperature_2m_min[idx]);
      const icon = getWeatherEmoji(daily.weather_code[idx]);
      
      return `
        <div class="forecast-item" style="${isToday ? 'border:1px solid var(--accent-color); background:rgba(197, 160, 89, 0.05);' : ''}">
          <span class="f-date" style="${isToday ? 'color:var(--accent-color); font-weight:800;' : ''}">${dateTxt}</span>
          <span class="f-icon">${icon}</span>
          <span class="f-temp">${max}Â°</span>
          <span class="f-temp-min">${min}Â°</span>
        </div>
      `;
    }).join("");

    const fList = document.getElementById("forecastList");
    if(fList) fList.innerHTML = forecastHtml;

  } catch(e) {
    console.error("Detailed weather fetch failed", e);
    const fList = document.getElementById("forecastList");
    if(fList) fList.innerHTML = `<div style="padding:10px; font-size:12px; color:var(--text-sub);">ë‚ ì”¨ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>`;
  }
}

fetchTaipeiWeather();
    
function login() {
  const id = document.getElementById("employeeId").value.trim();
  const user = employees.find(e => e.id === id);

  if (!user) {
    document.getElementById("loginError").textContent = "ë“±ë¡ë˜ì§€ ì•Šì€ ì‚¬ë²ˆì…ë‹ˆë‹¤.";
    return;
  }

  currentUser = user;
  
  // ğŸ”¥ [ìˆ˜ì •] ë¡œê·¸ì¸ í›„ ìœ ì €ì˜ í•­ê³µì‚¬ ì •ë³´ì— ë§ì¶° í™ˆ í™”ë©´ ê³µí•­ ë¯¸íŒ… ì•ˆë‚´ ë™ì  ë³€ê²½ (ê³ ê¸‰ ì¹´ë“œí˜• ë°°ì§€ ë””ìì¸)
  const airline = currentUser?.flight?.departure?.airline || "";
  const isKorean = String(airline).includes("ëŒ€í•œí•­ê³µ");
  const isAsiana = String(airline).includes("ì•„ì‹œì•„ë‚˜");
  
  let homeMeetingHtml = `<span style="display:block; font-size:13px; color:#fca5a5; font-weight:600; letter-spacing:-0.5px; word-break:keep-all; margin-top:4px;">- ê³µí•­ ë¯¸íŒ… ì¥ì†Œë¥¼ ê°œë³„ í™•ì¸í•´ ì£¼ì„¸ìš”.</span>`;
  
  if (isKorean) {
    homeMeetingHtml = `
      <div style="margin-top:6px; background:rgba(0, 0, 0, 0.3); border:1px solid rgba(96, 165, 250, 0.3); border-radius:10px; padding:8px 10px; display:flex; align-items:center; gap:8px;">
        <span style="background:#005eb8; color:#fff; font-size:11px; font-weight:800; padding:3px 6px; border-radius:6px; flex-shrink:0; box-shadow:0 2px 4px rgba(0,0,0,0.2);">ëŒ€í•œí•­ê³µ</span>
        <span style="font-size:12.5px; color:rgba(255,255,255,0.95); font-weight:500; line-height:1.3; letter-spacing:-0.3px;">Aì¹´ìš´í„° 1ë²ˆì¶œêµ¬ ì•<br><strong style="color:#93c5fd; font-weight:800;">1~2ë²ˆ í…Œì´ë¸”</strong> <br><strong style="color:#fff; font-weight:800;"> ì˜¤ì „ 6ì‹œ</strong> ë¯¸íŒ…</span>
      </div>`;
  } else if (isAsiana) {
    homeMeetingHtml = `
      <div style="margin-top:6px; background:rgba(0, 0, 0, 0.3); border:1px solid rgba(248, 113, 113, 0.3); border-radius:10px; padding:8px 10px; display:flex; align-items:center; gap:8px;">
        <span style="background:#dc2626; color:#fff; font-size:11px; font-weight:800; padding:3px 6px; border-radius:6px; flex-shrink:0; box-shadow:0 2px 4px rgba(0,0,0,0.2);">ì•„ì‹œì•„ë‚˜</span>
        <span style="font-size:12.5px; color:rgba(255,255,255,0.95); font-weight:500; line-height:1.3; letter-spacing:-0.3px;">Nì¹´ìš´í„° 12ë²ˆì¶œêµ¬ ì•<br><strong style="color:#fca5a5; font-weight:800;">25~26ë²ˆ í…Œì´ë¸”</strong> <br><strong style="color:#fff; font-weight:800;"> ì˜¤ì „ 5ì‹œ</strong> ë¯¸íŒ…</span>
      </div>`;
  }
  
  const meetingBox = document.getElementById("dynamicHomeMeeting");
  if (meetingBox) {
    meetingBox.innerHTML = `
      <span class="loc-badge" style="display:inline-flex; margin-bottom:0px; margin-top:4px;">ğŸ“ ì¸ì²œêµ­ì œê³µí•­ 2ì²­ì‚¬</span>
      ${homeMeetingHtml}
    `;
  }

  document.getElementById("loginSection").style.display = "none";
  document.getElementById("mainSection").style.display = "block";
  document.getElementById("employeeName").textContent = user.name;
  document.body.classList.add("logged-in");
}

function logout() {
  if(!confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
  currentUser = null;
  document.body.classList.remove("logged-in");
  document.body.classList.remove("menu-open");
  
  document.getElementById("mainSection").style.display = "none";
  document.getElementById("loginSection").style.display = "block";
  document.getElementById("employeeId").value = "";
  goHome(); 
}

/* ğŸ”¥ [ìˆ˜ì •] QR ìŠ¤ìº”ì„ í†µí•œ ìë™ ë¡œê·¸ì¸ ì‹œ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ íë¦„ ì œì–´ ì¶”ê°€ */
function tryAutoLogin() {
  const params = new URLSearchParams(window.location.search);
  const eid = params.get("eid");
  if (!eid) return;

  const input = document.getElementById("employeeId");
  if (input) input.value = eid;

  const user = employees.find(e => String(e.id) === String(eid));
  if (!user) {
    // âŒ ì‚¬ë²ˆ ìœ íš¨í•˜ì§€ ì•Šì„ ë•Œ: ë¡œë”©ì°½ ë„ê³  ë‹¤ì‹œ ë¡œê·¸ì¸ì°½ ì‚´ë¦¼
    const tempStyle = document.getElementById("hideLoginTemp");
    if(tempStyle) tempStyle.remove();
    document.getElementById("lanternLoading").style.display = "none";
    document.getElementById("loginError").textContent = "QR ì‚¬ë²ˆì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
    return;
  }

  // âœ… ì •ìƒ ë¡œê·¸ì¸ ì¼ ë•Œ: ì´ë¯¸ ì¼œì ¸ìˆëŠ” í’ë“± ë¡œë”©ì°½ì„ 2ì´ˆê°„ êµ¬ê²½ì‹œì¼œì¤€ ë’¤ í™”ë©´ ì „í™˜
  setTimeout(() => {
    login(); // ì‹¤ì œ ë©”ì¸í™”ë©´ìœ¼ë¡œ ì „í™˜í•˜ëŠ” í•¨ìˆ˜ ì‹¤í–‰
    
    // í™”ë©´ì€ ì´ë¯¸ ë©”ì¸ìœ¼ë¡œ ë°”ë€Œì—ˆê³ , ê·¸ ìœ„ì— ë– ìˆëŠ” ë¡œë”©ì°½ì„ ì„œì„œíˆ í˜ì´ë“œ ì•„ì›ƒ ì‹œí‚´
    const loader = document.getElementById("lanternLoading");
    loader.style.opacity = '0';
    
    setTimeout(() => { 
      // ì™„ì „íˆ íˆ¬ëª…í•´ì§€ë©´ DOMì—ì„œ ìˆ¨ê¸°ê³ , ë°©ì§€ìš© style íƒœê·¸ë„ ì œê±°
      loader.style.display = 'none'; 
      loader.style.opacity = '1'; 
      const tempStyle = document.getElementById("hideLoginTemp");
      if(tempStyle) tempStyle.remove();
    }, 500); // CSS opacity transition ì‹œê°„ì´ 0.5ì´ˆì„
    
  }, 2200); // í’ë“±+ì¹´ë£¡ì´ ì˜¬ë¼ê°€ëŠ” ê±° ê°ìƒí•˜ëŠ” ì‹œê°„ì„ 2.2ì´ˆë¡œ ì•½ê°„ ì—°ì¥
}

const travelSchedule = [
  {
    day: "DAY 1", date: "2026.03.11 (ìˆ˜)", title: "ì„¤ë ˆëŠ” ì‹œì‘, íƒ€ì´ë² ì´",
    items: [
      { time:"08:00/9:00", icon:"âœˆï¸", title:"ì¸ì²œêµ­ì œê³µí•­ 2í„°ë¯¸ë„ ì¶œë°œ", desc:"OZ 711 / KE 2021" },
      { time:"12:30/13:30", icon:"ğŸœ", title:"ì¤‘ì‹ | ìš°ìœ¡ë©´", desc:"ëŒ€ë§Œì˜ ì†Œìš¸ í‘¸ë“œ, ì§„í•œ êµ­ë¬¼ì˜ ìš°ìœ¡ë©´" },
      { time:"13:30/14:30", icon:"ğŸ›ï¸", title:"ë‹¨ìˆ˜ì´ ì˜›ê±°ë¦¬/í™ë§ˆì˜¤ì²­/ì§„ë¦¬ëŒ€í•™", desc:"ë¶‰ì€ ë²½ëŒì˜ ì—­ì‚¬ì™€ ì˜í™” ë§í•  ìˆ˜ ì—†ëŠ” ë¹„ë°€ ì´¬ì˜ì§€" },
      { time:"16:30/17:30", icon:"ğŸ¨", title:"í˜¸í…” ì²´í¬ì¸", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" },
      { time:"18:00/18:30", icon:"ğŸ½ï¸", title:"ì„ì‹ | íƒ€ì¹´ì˜¤ ìƒ¤ë¸Œìƒ¤ë¸Œ", desc:"1ì¸ 1ëƒ„ë¹„ë¡œ ì¦ê¸°ëŠ” í”„ë¦¬ë¯¸ì—„ ìƒ¤ë¸Œìƒ¤ë¸Œ" },
      { time:"19:30/20:00", icon:"ğŸŒƒ", title:"íƒ€ì´ë² ì´ 101 ì „ë§ëŒ€", desc:"íƒ€ì´ë² ì´ì˜ ì•¼ê²½ì„ í•œëˆˆì— ë‹´ëŠ” ëœë“œë§ˆí¬" },
      { time:"21:00/21:30", icon:"ğŸ¨", title:"í˜¸í…”ë³µê·€", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" }
    ]
  },
  {
    day: "DAY 2", date: "2026.03.12 (ëª©)", title: "íë§ê³¼ í™”í•©ì˜ ë°¤",
    items: [
      { time:"08:30/9:00", icon:"ğŸšŒ", title:"ì„ íƒ ê´€ê´‘", desc:"ê°œì¸ ì„ íƒ ì¼ì •" },
      { time:"08:30", icon:"ğŸšŒ", title:"í‹°ì—”ë¼ì´ ì˜¨ì²œ", desc:"ì–‘ëª…ì‚°ì˜ ìì—°ì„ ë°”ë¼ë³´ë©° ì¦ê¸°ëŠ” ìœ í™© ì˜¨ì²œ" },
      { time:"9:00", icon:"ğŸ›ï¸", title:"ê³ ê¶ë°•ë¬¼ê´€", desc:"ì¤‘êµ­ 5ì²œë…„ ì—­ì‚¬ì˜ ë³´ë¬¼ ì°½ê³ " },
      { time:"13:00", icon:"ğŸ½ï¸", title:"ì¤‘ì‹ | ë² ì´ì§•ë•", desc:"ë°”ì‚­í•œ ê»ì§ˆê³¼ ì´‰ì´‰í•œ ì†ì‚´ì˜ ì¡°í™”" },
      { time:"14:30", icon:"ğŸ›ï¸", title:"ì„œë¬¸ì •", desc:"íƒ€ì´ë² ì´ì˜ ëª…ë™, ì ŠìŒê³¼ í™œê¸°ì˜ ê±°ë¦¬" },
      { time:"08:30/9:00", icon:"ğŸ§­", title:"ììœ ì‹œê°„", desc:"ì¤‘ì‹ë¹„ ì§€ê¸‰" },
      { time:"18:00", icon:"ğŸ‰", title:"ISC ë§Œì°¬", desc:"í•„ìˆ˜ ì°¸ì„-í™”í•©ê³¼ ì¶•í•˜ì˜ ë°¤" }
    ]
  },
  {
    day: "DAY 3", date: "2026.03.13 (ê¸ˆ)", title: "ëŒ€ë§Œì˜ ìì—°ê³¼ ë‚­ë§Œ",
    items: [
      { time:"10:00", icon:"ğŸ¨ğŸ½ï¸", title:"í˜¸í…” ì¡°ì‹ í›„ ì¶œë°œ", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" },
      { time:"11:00", icon:"ğŸŒŠ", title:"ì•¼ë¥˜ í•´ìƒê³µì›", desc:"ìì—°ì´ ì¡°ê°í•œ ê¸°ì•”ê´´ì„" },
      { time:"12:30", icon:"ğŸ¦", title:"ì¤‘ì‹ | ì”¨í‘¸ë“œ", desc:"ë°”ë‹¤ í–¥ ê°€ë“í•œ ì‹ ì„ í•œ í˜„ì§€ í•´ì‚°ë¬¼" },
      { time:"14:30", icon:"ğŸ®", title:"ìŠ¤í€ ì²œë“±ë‚ ë¦¬ê¸°", desc:"ê¸°ì°»ê¸¸ ìœ„ì—ì„œ ì†Œì›ì„ ë‹´ì•„ ë‚ ë¦¬ëŠ” ì²œë“±" },
      { time:"17:00", icon:"ğŸ®", title:"ì§€ìš°í€ ì•¼ê²½", desc:"í™ë“±ì´ ë°íˆëŠ” ì¢ì€ ê³¨ëª©ì˜ ëª½í™˜ì  ë¶„ìœ„ê¸°" },
      { time:"20:00", icon:"ğŸŒŠ", title:"ì•¼ì‹œì¥ ë° ì„ì‹", desc:"ì§€íŒŒì´, ë§ê³ ë¹™ìˆ˜ ë“± ëŒ€ë§Œ ê¸¸ê±°ë¦¬ ìŒì‹ ì •ë³µ" },
      { time:"21:30", icon:"ğŸ¨", title:"í˜¸í…”ë³µê·€", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" },
      { time:"ì „ì¼", icon:"ğŸ§­", title:"ììœ ì¼ì • ì„ íƒì‹œ", desc:"ì „ì²´ ê°œì¸ë¶€ë‹´(ì¤‘ì‹ë¹„ ì§€ê¸‰ X)" }
    ]
  },
  {
    day: "DAY 4", date: "2026.03.14 (í† )", title: "êµ¿ë°”ì´ íƒ€ì´ë² ì´",
    items: [
      { time:"08:00/9:00", icon:"ğŸ¨", title:"í˜¸í…” ì²´í¬ì•„ì›ƒ", desc:"íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…”[5ì„±ê¸‰]" },
      { time:"11:40/12:25", icon:"âœˆï¸", title:"íƒ€ì´ë² ì´ ì¶œë°œ", desc:"OZ 712 / KE 2022" },
      { time:"15:25/15:50", icon:"ğŸ‡°ğŸ‡·", title:"ì¸ì²œ ë„ì°©", desc:"ISC in Taiwan" }
    ]
  }
];
    
function normalizeTime(t) {
  const s = String(t).trim();
  const m = s.match(/^(\d{1,2}):(\d{2})$/);
  if (!m) return s;
  return `${String(m[1]).padStart(2, "0")}:${m[2]}`;
}

function pickTimeByAirline(timeStr, airline) {
  const parts = String(timeStr).split("/").map(s => normalizeTime(s));
  if (parts.length === 1) return parts[0];
  const isKoreanAir = String(airline || "").includes("ëŒ€í•œí•­ê³µ");
  return isKoreanAir ? parts[parts.length - 1] : parts[0];
}

function buildDay2ItemsForUser(user, userAirline) {
  const tours = user?.myTour || [];
  const hasTienlai = tours.some(v => String(v).includes("í‹°ì—”ë¼ì´"));
  const hasGugung  = tours.some(v => String(v).includes("ê³ ê¶ë°•ë¬¼ê´€"));
  const hasFree    = tours.some(v => String(v).includes("ììœ ì¼ì •"));

  const day2 = travelSchedule.find(d => d.day === "DAY 2");
  const items = day2?.items || [];
  const byTitle = (title) => items.find(x => x.title === title);

  const itemSelect = byTitle("ì„ íƒ ê´€ê´‘");
  const itemTienlai = byTitle("í‹°ì—”ë¼ì´ ì˜¨ì²œ");
  const itemGugung  = byTitle("ê³ ê¶ë°•ë¬¼ê´€");
  const itemLunch   = byTitle("ì¤‘ì‹");
  const itemXimen   = byTitle("ì„œë¬¸ì •");
  const itemFree    = byTitle("ììœ ì‹œê°„");
  const itemDinner  = byTitle("ISC ë§Œì°¬");

  if (hasTienlai && hasGugung && hasFree) return [...(itemSelect ? [itemSelect] : []), ...(itemLunch ? [itemLunch] : []), ...(itemXimen ? [itemXimen] : []), ...(itemDinner ? [itemDinner] : [])];
  if (hasFree && !hasTienlai && !hasGugung) return [...(itemFree ? [itemFree] : []), ...(itemDinner ? [itemDinner] : [])];
  if (hasTienlai) return [...(itemTienlai ? [itemTienlai] : []), ...(itemLunch ? [itemLunch] : []), ...(itemXimen ? [itemXimen] : []), ...(itemDinner ? [itemDinner] : [])];
  if (hasGugung) return [...(itemGugung ? [itemGugung] : []), ...(itemLunch ? [itemLunch] : []), ...(itemXimen ? [itemXimen] : []), ...(itemDinner ? [itemDinner] : [])];
  
  return [...(itemSelect ? [itemSelect] : []), ...(itemDinner ? [itemDinner] : [])];
}

function pickFlightDescByAirline(desc, airline) {
  const s = String(desc || "");
  if (!s.includes("/")) return s;
  const isKoreanAir = String(airline || "").includes("ëŒ€í•œí•­ê³µ");
  const parts = s.split("/").map(v => v.trim()); 
  return isKoreanAir ? (parts[1] || s) : (parts[0] || s);
}

/* ğŸ”¥ [ì¶”ê°€] íšŒí™” í…ìŠ¤íŠ¸ ë³µì‚¬ í•¨ìˆ˜ (ì•ˆì „í•˜ê²Œ ê¸°ì¡´ ë¡œì§ ìœ ì§€) */
function copyConvText(btn, text) {
  const textArea = document.createElement("textarea");
  textArea.value = text;
  document.body.appendChild(textArea);
  textArea.select();
  try {
    document.execCommand('copy');
    const originalHtml = btn.innerHTML;
    btn.innerHTML = '<span style="color:#16a34a">âœ… ë³µì‚¬ë¨</span>';
    setTimeout(() => { btn.innerHTML = originalHtml; }, 1500);
  } catch (err) {
    console.error('ë³µì‚¬ ì‹¤íŒ¨', err);
  }
  document.body.removeChild(textArea);
}

function openPage(type, fromHistory = false) {
  document.body.classList.remove('menu-open'); 

  const userAirline = currentUser?.flight?.departure?.airline || ""; 
  
  if (!fromHistory) {
    pageHistory.push(type);
    history.pushState({ page: type }, "", "");
  }

  const detail = document.getElementById("detailPage");
  detail.style.display = "block";
  requestAnimationFrame(() => { document.body.classList.add("detail-open"); });

  const t = document.getElementById("detailTitle");
  const c = document.getElementById("detailContent");

  if (type.startsWith("day_")) {
    const idx = parseInt(type.split("_")[1]);
    const day = travelSchedule[idx];
    t.textContent = `ğŸ—“ ${day.day} ì¼ì •`;

    const items = (day.day === "DAY 2") ? buildDay2ItemsForUser(currentUser, userAirline) : day.items;

    c.innerHTML = `
      <div class="detail-content-wrap">
        <div class="day-card">
          <h3>${day.day} <span>${day.date}</span></h3>
          <p class="day-title">${day.title}</p>
          <div class="timeline">
            ${items.map(i => `
              <div class="schedule-item">
                <div class="timeline-dot"></div>
                <div class="schedule-card">
                  <div class="schedule-time">${pickTimeByAirline(i.time, userAirline)}</div>
                  <div class="schedule-body">
                    <div class="schedule-title">${i.icon} ${i.title}</div>
                    ${i.desc ? `<div class="schedule-desc">${pickFlightDescByAirline(i.desc, userAirline)}</div>` : ""}
                  </div>
                </div>
              </div>
            `).join("")}
          </div>
        </div>
      </div>
    `;
    return;
  }

  if (type === "flight") {
    const dep = currentUser.flight.departure;
    const ret = currentUser.flight.return;
    t.textContent = "âœˆï¸ í•­ê³µí¸ ì •ë³´";
    
    // ğŸ”¥ [ìˆ˜ì •] ìƒì„¸ í˜ì´ì§€ ì „ìš©: ë¡œê·¸ì¸ ì •ë³´ì— ë”°ë¼ ë¯¸íŒ… ì¥ì†Œë¥¼ ê³ ê¸‰ìŠ¤ëŸ½ê²Œ í‘œì‹œ
    const isKorean = String(userAirline).includes("ëŒ€í•œí•­ê³µ");
    const isAsiana = String(userAirline).includes("ì•„ì‹œì•„ë‚˜");
    
    let detailMeetingHtml = `<span style="display:block; font-size:13px; color:#991b1b; font-weight:700; letter-spacing:-0.5px; margin-top:4px;">- ê³µí•­ ë¯¸íŒ… ì¥ì†Œë¥¼ ê°œë³„ í™•ì¸í•´ ì£¼ì„¸ìš”.</span>`;
    
    if (isKorean) {
      detailMeetingHtml = `
        <div style="margin-top:8px; background:#eff6ff; border:1px solid #bfdbfe; border-radius:10px; padding:12px; display:flex; align-items:center; gap:10px;">
          <span style="background:#005eb8; color:#fff; font-size:12px; font-weight:800; padding:4px 8px; border-radius:6px; flex-shrink:0; box-shadow:0 2px 4px rgba(0,0,0,0.1);">ëŒ€í•œí•­ê³µ</span>
          <span style="font-size:13.5px; color:#1e293b; font-weight:600; line-height:1.4; letter-spacing:-0.3px;">Aì¹´ìš´í„° 1ë²ˆì¶œêµ¬ ì•<br><strong style="color:#1d4ed8; font-weight:800;">1~2ë²ˆ í…Œì´ë¸”</strong> ë¯¸íŒ…</span>
        </div>`;
    } else if (isAsiana) {
      detailMeetingHtml = `
        <div style="margin-top:8px; background:#fef2f2; border:1px solid #fecaca; border-radius:10px; padding:12px; display:flex; align-items:center; gap:10px;">
          <span style="background:#dc2626; color:#fff; font-size:12px; font-weight:800; padding:4px 8px; border-radius:6px; flex-shrink:0; box-shadow:0 2px 4px rgba(0,0,0,0.1);">ì•„ì‹œì•„ë‚˜</span>
          <span style="font-size:13.5px; color:#1e293b; font-weight:600; line-height:1.4; letter-spacing:-0.3px;">Nì¹´ìš´í„° 12ë²ˆì¶œêµ¬ ì•<br><strong style="color:#b91c1c; font-weight:800;">25~26ë²ˆ í…Œì´ë¸”</strong> ë¯¸íŒ…</span>
        </div>`;
    }

    c.innerHTML = `
      <div class="detail-content-wrap">
        <div style="background: #fffef0; border: 1px solid #fde047; border-radius: 16px; padding: 16px; margin-bottom: 20px; display: flex; align-items: flex-start; gap: 12px; box-shadow: 0 4px 12px rgba(253,224,71,0.1);">
          <div style="font-size: 22px; line-height: 1;">â°</div>
          <div style="display: flex; flex-direction: column; gap: 8px; width: 100%;">
            <div>
              <strong style="color: #b45309; font-size: 15px; font-weight: 800; display: block; margin-bottom: 4px;">ê³µí•­ ë„ì°© ì‹œê°„ ì•ˆë‚´</strong>
              <span style="color: #92400e; font-size: 13px; line-height: 1.4; font-weight: 600; display: block;">ì›í™œí•œ íƒ‘ìŠ¹ ìˆ˜ì†ì„ ìœ„í•´ <strong style="color:#dc2626; font-weight:800;">ì¶œë°œ 3ì‹œê°„ ì „ê¹Œì§€</strong> ë°˜ë“œì‹œ ê³µí•­ì— ë„ì°©í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</span>
            </div>
            <div style="margin-top: 4px;">
              <span class="loc-badge-flight" style="margin-top:0; margin-bottom:0;">ğŸ“ ì¸ì²œêµ­ì œê³µí•­ 2ì²­ì‚¬</span>
              ${detailMeetingHtml}
            </div>
          </div>
        </div>
        
        <div class="day-card"><h3>ì¶œêµ­í¸</h3><div class="schedule-item"><div class="schedule-card"><div class="schedule-time">${dep.time}</div><div class="schedule-body"><div class="schedule-title">âœˆï¸ ${dep.from} â†’ ${dep.to}</div><div class="schedule-desc">${dep.airline} ${dep.flightNo}</div><div class="schedule-desc">${dep.date}</div></div></div></div></div>
        <div class="day-card"><h3>ê·€êµ­í¸</h3><div class="schedule-item"><div class="schedule-card"><div class="schedule-time">${ret.time}</div><div class="schedule-body"><div class="schedule-title">ğŸ  ${ret.from} â†’ ${ret.to}</div><div class="schedule-desc">${ret.airline} ${ret.flightNo}</div><div class="schedule-desc">${ret.date}</div></div></div></div></div>
      </div>`;
  }

  if (type === "myTour") {
    t.textContent = "ğŸ’ ë‚˜ì˜ ì„ íƒ ê´€ê´‘";
    c.innerHTML = `<div class="detail-content-wrap"><div class="mytour-wrap">${renderMyTour()}</div></div>`;
    setTimeout(() => {
      const wrap = document.querySelector('.meal-check[data-tour="ììœ ì¼ì •"]');
      if (!wrap) return;
      syncMealStatusFromServer(currentUser.id, "ììœ ì¼ì •", wrap);
      const saved = loadMealPaid(currentUser.id, "ììœ ì¼ì •");
      if (!wrap.classList.contains("done") && saved?.time) setMealUI(wrap, "DONE", saved.time);
    }, 0);
  }

  if (type === "taiwan") {
    t.textContent = "ğŸ‡¹ğŸ‡¼ ëŒ€ë§Œì˜ ëª¨ë“  ê²ƒ";
    c.innerHTML = `
      <div class="detail-content-wrap">
        <div class="country-compare-grid">
          <div class="country-card">
            <div class="country-header">
              <img src="assets/images/flag-kr.jpg" class="flag-img" onerror="this.style.display='none'">
              <h3>ëŒ€í•œë¯¼êµ­</h3>
            </div>
            <div class="time-box">
              <span class="time-label">í˜„ì¬ ì‹œê°</span>
              <strong id="timeKR">--:--:--</strong>
            </div>
            <ul class="country-list">
              <li><span>ì‹œì°¨</span><strong>ê¸°ì¤€ êµ­ê°€</strong></li>
              <li><span>ì¸êµ¬</span><strong>ì•½ 5,100ë§Œ ëª…</strong></li>
              <li><span>ë©´ì </span><strong>ì•½ 100,210ã¢</strong></li>
              <li><span>GDP</span><strong>ì•½ 1.7ì¡° ë‹¬ëŸ¬</strong></li>
            </ul>
          </div>
          <div class="country-card">
            <div class="country-header">
              <img src="assets/images/flag-tw.jpg" class="flag-img" onerror="this.style.display='none'">
              <h3>ëŒ€ë§Œ</h3>
            </div>
            <div class="time-box">
              <span class="time-label">í˜„ì¬ ì‹œê°</span>
              <strong id="timeTW">--:--:--</strong>
            </div>
            <ul class="country-list">
              <li><span>ì‹œì°¨</span><strong>í•œêµ­ë³´ë‹¤ 1ì‹œê°„ ëŠë¦¼</strong></li>
              <li><span>ì¸êµ¬</span><strong>ì•½ 2,300ë§Œ ëª…</strong></li>
              <li><span>ë©´ì </span><strong>ì•½ 36,197ã¢</strong></li>
              <li><span>GDP</span><strong>ì•½ 0.8ì¡° ë‹¬ëŸ¬</strong></li>
            </ul>
          </div>
        </div>

        <div class="weather-detail-wrapper">
          <div class="weather-current-row">
            <div class="w-city">
              <span>ğŸ‡°ğŸ‡· ì„œìš¸ (í˜„ì¬)</span>
              <strong id="seoulTempDetail">--Â°C</strong>
            </div>
            <div class="w-vs">|</div>
            <div class="w-city">
              <span>ğŸ‡¹ğŸ‡¼ íƒ€ì´ë² ì´ (í˜„ì¬)</span>
              <strong id="taipeiTempDetail">--Â°C</strong>
            </div>
          </div>
          
          <div class="forecast-container">
            <div class="forecast-header">
              <span>ğŸ“… íƒ€ì´ë² ì´ ì£¼ê°„ ì˜ˆë³´</span>
              <span class="forecast-update" id="weatherUpdateTime">ì—…ë°ì´íŠ¸ ì¤‘...</span>
            </div>
            <div class="forecast-list" id="forecastList">
              <div style="font-size:12px; color:var(--text-sub); padding:10px; text-align:center; width:100%;">ì˜ˆë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
            </div>
          </div>
        </div>

        <div class="exchange-row">
            ì‹¤ì‹œê°„ í™˜ìœ¨: <strong>1 TWD â‰ˆ <span id="twFxRate">ë¡œë”©ì¤‘..</span>ì›</strong>
            <br><span style="font-size:12px; opacity:0.8;">(ì—…ë°ì´íŠ¸: <span id="twFxTime">-</span>)</span>
        </div>
        <p class="exchange-note" style="text-align:center; font-size:13px; font-weight:600; color:var(--text-sub);">â€» í™˜ìœ¨ì€ ì‹¤ì‹œê°„ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        
        <div class="day-card" style="margin-top:20px;">
          <h3 style="margin: 0 0 16px; font-size: 18px; color: var(--primary-color); font-weight: 800; display:flex; align-items:center; gap:6px;">
            <span style="font-size:20px;">ğŸ’¡</span> ëŒ€ë§Œ ì—¬í–‰ í•„ìˆ˜ ì •ë³´
          </h3>
          
          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px;">
            <div style="background:var(--bg-main); padding:16px; border-radius:12px; border:1px solid var(--border-light);">
               <h4 style="margin:0 0 8px; font-size:13px; color:var(--text-sub); font-weight:700;">ğŸ”Œ ì „ì•• ë° ì½˜ì„¼íŠ¸</h4>
               <p style="margin:0; font-size:15px; font-weight:800; color:var(--primary-color); letter-spacing:-0.5px;">110V / 60Hz</p>
               <span style="font-size:12px; color:#e53e3e; font-weight:700; margin-top:4px; display:block; letter-spacing:-0.5px;">â€» 11ìí˜•(ë¼ì§€ì½”) í•„ìˆ˜</span>
            </div>
            <div style="background:var(--bg-main); padding:16px; border-radius:12px; border:1px solid var(--border-light);">
               <h4 style="margin:0 0 8px; font-size:13px; color:var(--text-sub); font-weight:700;">ğŸ›‚ ë¹„ì (Visa)</h4>
               <p style="margin:0; font-size:15px; font-weight:800; color:var(--primary-color); letter-spacing:-0.5px;">90ì¼ ë¬´ë¹„ì</p>
               <span style="font-size:12px; color:var(--text-sub); font-weight:600; margin-top:4px; display:block; letter-spacing:-0.5px;">í•œêµ­ ì—¬ê¶Œ ì†Œì§€ì ê¸°ì¤€</span>
            </div>
            <div style="background:var(--bg-main); padding:16px; border-radius:12px; border:1px solid var(--border-light);">
               <h4 style="margin:0 0 8px; font-size:13px; color:var(--text-sub); font-weight:700;">ğŸª™ íŒ ë¬¸í™”</h4>
               <p style="margin:0; font-size:15px; font-weight:800; color:var(--primary-color); letter-spacing:-0.5px;">íŒ ë¬¸í™” ì—†ìŒ</p>
               <span style="font-size:12px; color:var(--text-sub); font-weight:600; margin-top:4px; display:block; letter-spacing:-0.5px;">ëŒ€ë¶€ë¶„ 10% ë´‰ì‚¬ë£Œ í¬í•¨</span>
            </div>
            <div style="background:var(--bg-main); padding:16px; border-radius:12px; border:1px solid var(--border-light);">
               <h4 style="margin:0 0 8px; font-size:13px; color:var(--text-sub); font-weight:700;">ğŸ—£ï¸ ì‚¬ìš© ì–¸ì–´</h4>
               <p style="margin:0; font-size:15px; font-weight:800; color:var(--primary-color); letter-spacing:-0.5px;">ì¤‘êµ­ì–´(ë²ˆì²´)</p>
               <span style="font-size:12px; color:var(--text-sub); font-weight:600; margin-top:4px; display:block; letter-spacing:-0.5px;">ì£¼ìš” ê´€ê´‘ì§€ ì˜/í•œ í†µìš©</span>
            </div>
          </div>

          <div style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding:18px; border-radius:12px; position:relative; overflow:hidden; border:1px solid var(--border-light);">
            <div style="position:relative; z-index:2;">
               <h4 style="margin:0 0 8px; font-size:15px; font-weight:800; color:var(--primary-color); display:flex; align-items:center; gap:6px;">â›… 3ì›”ì˜ ëŒ€ë§Œ, ë‚ ì”¨ì™€ ì˜·ì°¨ë¦¼</h4>
               <p style="margin:0 0 6px; font-size:13px; line-height:1.6; color:var(--text-main); word-break:keep-all;">
                 <strong>í‰ê·  ê¸°ì˜¨ 18~25â„ƒ</strong>ë¡œ í•œêµ­ì˜ ì´ˆì—¬ë¦„~ë´„ ë‚ ì”¨ì™€ ë¹„ìŠ·í•©ë‹ˆë‹¤. ë‚®ì—ëŠ” ê°€ë²¼ìš´ ì˜·ì°¨ë¦¼ì´ ì¢‹ì§€ë§Œ, ì•„ì¹¨ì €ë…ì´ë‚˜ ì—ì–´ì»¨ì´ ê°•í•œ ì‹¤ë‚´ì—ì„œëŠ” ìŒ€ìŒ€í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ <strong style="color:#2b6cb0;">ì–‡ì€ ê²‰ì˜·(ê°€ë””ê±´, ë°”ëŒë§‰ì´)</strong>ì„ ê¼­ ì±™ê²¨ì£¼ì„¸ìš”!
               </p>
            </div>
            <span style="font-size:70px; position:absolute; right:-10px; bottom:-15px; opacity:0.1; z-index:1;">ğŸ§¥</span>
          </div>
        </div>
      </div>`;
      
    startWorldClock();
    renderDetailedWeather();

    getFxRate().then(data => {
        const r = document.getElementById("twFxRate");
        const t = document.getElementById("twFxTime");
        if(r) r.textContent = fxFmt(data.rate);
        if(t) t.textContent = data.updatedUtc || "ë°©ê¸ˆ";
    });
  }

  if (type === "exchange") {
    t.textContent = "ğŸ’± í™˜ìœ¨ ê³„ì‚°ê¸°";
    c.innerHTML = `
      <div class="detail-content-wrap">
        <div class="exchange-row">í™˜ìœ¨: <strong>1 TWD â‰ˆ <span id="fxRateText">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</span>ì›</strong><br><span style="font-size:12px; color:#6b7280;">ì—…ë°ì´íŠ¸: <span id="fxUpdatedText">-</span></span><div style="margin-top:10px;"><button class="primary-btn" id="fxRefreshBtn" style="max-width:220px;">í™˜ìœ¨ ìƒˆë¡œê³ ì¹¨</button></div></div>
        <div class="day-card"><h3 class="section-title">TWD â†” KRW ê³„ì‚°</h3><div class="fx-grid"><div class="fx-box"><label>ëŒ€ë§Œë‹¬ëŸ¬ (TWD)</label><input id="inputTWD" type="text" inputmode="decimal" placeholder="ì˜ˆ: 1000"></div><div class="fx-eq">â‡„</div><div class="fx-box"><label>ì›í™” (KRW)</label><input id="inputKRW" type="text" inputmode="decimal" placeholder="ì˜ˆ: 42000"></div></div><p class="fx-note" style="margin-top:10px; font-size:13px; color:#6b7280; text-align:center;">â€» ìˆ«ì ì…ë ¥ ì‹œ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.</p></div>
      </div>`;
    initExchangeCalculatorAuto();
  }

  /* ğŸ”¥ [ì¶”ê°€] í•„ìˆ˜ ì—¬í–‰ íšŒí™” ë Œë”ë§ ë¡œì§ (ë‚´ìš© ëŒ€í­ í™•ì¥) */
  if (type === "conversation") {
    t.textContent = "ğŸ’¬ í•„ìˆ˜ ì—¬í–‰ íšŒí™”";
    const convData = [
      {
        title: "ì‹ë‹¹ / ì•¼ì‹œì¥", icon: "ğŸ¥Ÿ",
        items: [
          { ko: "ë©”ë‰´íŒ ì£¼ì„¸ìš”", cn: "è«‹çµ¦æˆ‘èœå–®", pr: "ì¹­ ê²Œì´ ì›Œ ì°¨ì´ë”´" },
          { ko: "ì´ê²ƒ ì£¼ì„¸ìš”", cn: "æˆ‘è¦é€™å€‹", pr: "ì›Œ ì•¼ì˜¤ ì©Œê±°" },
          { ko: "ê³ ìˆ˜ ë¹¼ì£¼ì„¸ìš”", cn: "ä¸è¦é¦™èœ", pr: "ë¶€ì•¼ì˜¤ ìƒ¹ì°¨ì´" },
          { ko: "ê³ ìˆ˜ ë§ì´ ì£¼ì„¸ìš”", cn: "å¤šåŠ é¦™èœ", pr: "ëšœì–´ ìŸˆ ìƒ¹ì°¨ì´" },
          { ko: "ë§µì§€ ì•Šê²Œ í•´ì£¼ì„¸ìš”", cn: "è«‹ä¸è¦åŠ è¾£", pr: "ì¹­ ë¶€ì•¼ì˜¤ ìŸˆ ë¼" },
          { ko: "í¬ì¥í•´ ì£¼ì„¸ìš”", cn: "æˆ‘è¦å¤–å¸¶", pr: "ì›Œ ì•¼ì˜¤ ì™€ì´ë”°ì´" },
          { ko: "ë§›ìˆì–´ìš”!", cn: "å¾ˆå¥½åƒ", pr: "í—Œ í•˜ì˜¤ ì¸ " },
          { ko: "ê³„ì‚°í•´ ì£¼ì„¸ìš”", cn: "è²·å–®", pr: "ë§ˆì´ ë”´" }
        ]
      },
      {
        title: "ì‡¼í•‘ / ê³„ì‚°", icon: "ğŸ›ï¸",
        items: [
          { ko: "ì–¼ë§ˆì¸ê°€ìš”?", cn: "å¤šå°‘éŒ¢", pr: "ëšœì–´ì‚¬ì˜¤ ì²¸" },
          { ko: "ë¹„ì‹¸ìš”, ê¹ì•„ì£¼ì„¸ìš”", cn: "å¤ªè²´äº†, ä¾¿å®œä¸€é»", pr: "íƒ€ì´ ê¾¸ì´ ëŸ¬, í”¼ì—”ì´ ì´ë””ì—”" },
          { ko: "ì…ì–´ë´ë„ ë˜ë‚˜ìš”?", cn: "å¯ä»¥è©¦ç©¿å—", pr: "ì»¤ì´ ìŠ¤ ì´¨ ë§ˆ" },
          { ko: "ë‹¤ë¥¸ ìƒ‰ìƒ ìˆë‚˜ìš”?", cn: "æœ‰åˆ¥çš„é¡è‰²å—", pr: "ì—¬ìš° ë¹„ì— ë” ì˜Œì¨ ë§ˆ" },
          { ko: "ì¹´ë“œ ê²°ì œ ë˜ë‚˜ìš”?", cn: "å¯ä»¥åˆ·å¡å—", pr: "ì»¤ì´ ìŠˆì•„ ì¹´ ë§ˆ" },
          { ko: "ë´‰íˆ¬ ì£¼ì„¸ìš”", cn: "è«‹çµ¦æˆ‘è¢‹å­", pr: "ì¹­ ê²Œì´ ì›Œ ë”°ì´ì¦ˆ" }
        ]
      },
      {
        title: "êµí†µ / ê¸¸ì°¾ê¸°", icon: "ğŸš‡",
        items: [
          { ko: "í™”ì¥ì‹¤ì´ ì–´ë””ì¸ê°€ìš”?", cn: "æ´—æ‰‹é–“åœ¨å“ªè£¡", pr: "ì‹œì‡¼ìš°ì§€ì—” ì§œì´ ë‚ " },
          { ko: "ì—­ì´ ì–´ë””ì¸ê°€ìš”?", cn: "æ·é‹ç«™åœ¨å“ªè£¡", pr: "ì§€ì—ìœˆì§  ì§œì´ ë‚ " },
          { ko: "íƒ€ì´ë² ì´ ë©”ì¸ì—­ìœ¼ë¡œ ê°€ì£¼ì„¸ìš”", cn: "è«‹åˆ°å°åŒ—è»Šç«™", pr: "ì¹­ ë”°ì˜¤ íƒ€ì´ë² ì´ ì²˜ì§ " },
          { ko: "ì—¬ê¸°ì„œ ì„¸ì›Œì£¼ì„¸ìš”", cn: "è«‹åœ¨é€™è£¡åœ", pr: "ì¹­ ì§œì´ ì©Œë¦¬ íŒ…" },
          { ko: "ì–¼ë§ˆë‚˜ ê±¸ë¦¬ë‚˜ìš”?", cn: "éœ€è¦å¤šä¹…æ™‚é–“", pr: "ì‰¬ì•¼ì˜¤ ëšœì–´ì§€ìš° ìŠ¤ì§€ì—”" }
        ]
      },
      {
        title: "í˜¸í…” / ìˆ™ë°•", icon: "ğŸ¨",
        items: [
          { ko: "ì²´í¬ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤", cn: "æˆ‘è¦è¾¦ç†å…¥ä½", pr: "ì›Œ ì•¼ì˜¤ ë¹¤ë¦¬ ë£¨ì£¼" },
          { ko: "ì§ì„ ë³´ê´€í•´ì¤„ ìˆ˜ ìˆë‚˜ìš”?", cn: "å¯ä»¥å¯„æ”¾è¡Œæå—", pr: "ì»¤ì´ ì§€íŒ¡ ì‹±ë¦¬ ë§ˆ" },
          { ko: "ìˆ˜ê±´ ì¢€ ë” ì£¼ì„¸ìš”", cn: "è«‹å¤šçµ¦æˆ‘æ¯›å·¾", pr: "ì¹­ ëšœì–´ ê²Œì´ ì›Œ ë§ˆì˜¤ì§„" },
          { ko: "ì²´í¬ì•„ì›ƒ í• ê²Œìš”", cn: "æˆ‘è¦é€€æˆ¿", pr: "ì›Œ ì•¼ì˜¤ íˆ¬ì´íŒ¡" }
        ]
      },
      {
        title: "ê¸°ë³¸ ì¸ì‚¬", icon: "ğŸ‘‹",
        items: [
          { ko: "ì•ˆë…•í•˜ì„¸ìš”", cn: "ä½ å¥½", pr: "ë‹ˆí•˜ì˜¤" },
          { ko: "ê°ì‚¬í•©ë‹ˆë‹¤", cn: "è¬è¬", pr: "ì‹œì—ì‹œì—" },
          { ko: "ì£„ì†¡í•©ë‹ˆë‹¤", cn: "å°ä¸èµ·", pr: "ëšœì´ë¶€ì¹˜" },
          { ko: "ê´œì°®ìŠµë‹ˆë‹¤", cn: "æ²’é—œä¿‚", pr: "ë©”ì´ê½Œì‹œ" },
          { ko: "í•œêµ­ì–´ í•  ì¤„ ì•„ì„¸ìš”?", cn: "ä½ æœƒèªªéŸ“æ–‡å—", pr: "ë‹ˆ í›„ì´ ìŠˆì–´ í•œì› ë§ˆ" }
        ]
      }
    ];

    let convHtml = '<div class="detail-content-wrap">';
    convData.forEach((cat, idx) => {
      // âœ… ì²« ë²ˆì§¸ í•­ëª©(ì‹ë‹¹/ì•¼ì‹œì¥)ë§Œ ê¸°ë³¸ì ìœ¼ë¡œ ì—´ë ¤ìˆê²Œ ì„¤ì •
      convHtml += `
        <div class="conv-category ${idx === 0 ? 'open' : ''}">
          <div class="conv-header" onclick="this.parentElement.classList.toggle('open')">
            <div class="conv-header-left">
              <div class="conv-icon-bg">${cat.icon}</div>
              <span>${cat.title}</span>
            </div>
            <svg viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <div class="conv-list">
            ${cat.items.map(item => `
              <div class="conv-item">
                <div class="conv-text-box">
                  <div class="conv-ko">${item.ko}</div>
                  <div class="conv-cn">${item.cn}</div>
                  <div class="conv-pr-box">
                    <span class="conv-pr-badge">ë°œìŒ</span>
                    <span class="conv-pr">${item.pr}</span>
                  </div>
                </div>
                <button class="conv-copy-btn" onclick="copyConvText(this, '${item.cn}')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                  ë³µì‚¬
                </button>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    });
    convHtml += '</div>';
    c.innerHTML = convHtml;
  }
   
  if (type === "contact") {
    t.textContent = "ğŸ“ ê¸´ê¸‰ ì—°ë½ë§";
    c.innerHTML = `
      <div class="detail-content-wrap"><div class="day-card"><h3>ë¹„ìƒ ì—°ë½ë§</h3><div class="timeline">
      <div class="schedule-item"><div class="timeline-dot"></div><div class="schedule-card"><div class="schedule-body"><div class="schedule-title">ğŸ“ í˜„ì§€ ë‹´ë‹¹ì</div><div class="schedule-desc"> ì£¼ì˜ê·  ì†Œì¥ | +886 987 770 987</div></div></div></div>
      <div class="schedule-item"><div class="timeline-dot"></div><div class="schedule-card"><div class="schedule-body"><div class="schedule-title">ğŸ“ ëª¨ë‘íˆ¬ì–´</div><div class="schedule-desc"> ì„±ì£¼í˜„ ë§¤ë‹ˆì € | +82 10 3213 8377</div></div></div></div>
      <div class="schedule-item"><div class="timeline-dot"></div><div class="schedule-card"><div class="schedule-body"><div class="schedule-title">ğŸ“ íƒ€ì´ë² ì´ ë©”ë¦¬ì–´íŠ¸ í˜¸í…” </div><div class="schedule-desc"> +886 2 8502 9999</div></div></div></div>
      </div></div></div>`;
  }
}

async function syncMealStatusFromServer(userId, tour, wrap) {
  const url = `${MEAL_SHEET_URL}?mode=customerAdmin&id=${userId}`;
  const res = await fetch(url);
  const data = await res.json();
  const status = data.mealMap?.[tour];
  if (status === "APPROVE") setMealUI(wrap, "DONE", "ì„œë²„ ê¸°ì¤€");
  else setMealUI(wrap, "PENDING");
}

function goHome() {
  const steps = pageHistory.length;
  pageHistory = [];
  if (steps > 0) { history.go(-steps); }
  document.body.classList.remove("detail-open");
  document.body.classList.remove("menu-open");
  setTimeout(() => { document.getElementById("detailPage").style.display = "none"; }, 400); 
}

function goBack() {
  if (pageHistory.length > 0) { history.back(); } 
  else { goHome(); }
}

window.addEventListener("popstate", (event) => {
  if (document.body.classList.contains("menu-open")) {
    document.body.classList.remove("menu-open");
  }
  if (pageHistory.length > 0) {
    pageHistory.pop(); 
    if (pageHistory.length === 0) {
      document.body.classList.remove("detail-open");
      setTimeout(() => { document.getElementById("detailPage").style.display = "none"; }, 400); 
    } else {
      const prevType = pageHistory[pageHistory.length - 1];
      openPage(prevType, true);
    }
  }
});

function submitRequest() {
  const requestText = document.getElementById("requestInput").value.trim();
  if (!requestText) { alert("ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
  if (!currentUser) { alert("ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
   
  fetch(MEAL_SHEET_URL, {
    method: "POST", mode: "no-cors",
    body: JSON.stringify({ type: "request", id: currentUser.id, name: currentUser.name, request: requestText, time: nowKSTString() })
  }).then(() => { alert("ìš”ì²­ì‚¬í•­ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."); document.getElementById("requestInput").value = ""; }).catch(err => { console.error(err); alert("ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); });
}

function startWorldClock() {
  function updateTime() {
    const now = new Date();
    const kr = new Intl.DateTimeFormat("ko-KR", { timeZone: "Asia/Seoul", hour: "2-digit", minute: "2-digit", second: "2-digit" }).format(now);
    const tw = new Intl.DateTimeFormat("zh-TW", { timeZone: "Asia/Taipei", hour: "2-digit", minute: "2-digit", second: "2-digit" }).format(now);
    const krEl = document.getElementById("timeKR");
    const twEl = document.getElementById("timeTW");
    if (krEl && twEl) { krEl.textContent = kr; twEl.textContent = tw; }
  }
  updateTime();
  setInterval(updateTime, 1000);
}

const FX_CACHE_KEY = "fx_twd_krw_cache_v1";
const FX_CACHE_MS = 6 * 60 * 60 * 1000; 

function fxParse(v) {
  if (v == null) return NaN;
  const x = String(v).replace(/,/g, "").trim();
  if (x === "") return NaN;
  return Number(x);
}

function fxFmt(n) {
  if (!isFinite(n)) return "";
  const isInt = Math.abs(n - Math.round(n)) < 1e-10;
  return (isInt ? Math.round(n) : n).toLocaleString("ko-KR", { maximumFractionDigits: 2 });
}

async function fetchTwdToKrwRate() {
  const url = `https://open.er-api.com/v6/latest/USD?_t=${Date.now()}`;
  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) throw new Error("í™˜ìœ¨ API ì‹¤íŒ¨: " + res.status);
  
  const data = await res.json();
  const krwPerUsd = data?.rates?.KRW;
  const twdPerUsd = data?.rates?.TWD;
  
  if (!isFinite(krwPerUsd) || !isFinite(twdPerUsd)) throw new Error("KRW/TWD í™˜ìœ¨ ë°ì´í„° ì—†ìŒ");
  
  const nowKST = new Intl.DateTimeFormat("ko-KR", { 
    timeZone: "Asia/Seoul", month: "2-digit", day: "2-digit", hour: "2-digit", minute: "2-digit", second: "2-digit" 
  }).format(new Date());

  return { rate: krwPerUsd / twdPerUsd, updatedUtc: `ì˜¤ëŠ˜ ${nowKST}` };
}

function loadFxCache() {
  const raw = localStorage.getItem(FX_CACHE_KEY);
  if (!raw) return null;
  try {
    const v = JSON.parse(raw);
    if (!v.rate || !v.savedAt) return null;
    if (Date.now() - v.savedAt > FX_CACHE_MS) return null; 
    return v;
  } catch { return null; }
}

function saveFxCache(payload) {
  localStorage.setItem(FX_CACHE_KEY, JSON.stringify({ rate: payload.rate, updatedUtc: payload.updatedUtc, savedAt: Date.now() }));
}

async function getFxRate({ force = false } = {}) {
  if (!force) { 
    const cached = loadFxCache(); 
    if (cached) return cached; 
  }
  const fresh = await fetchTwdToKrwRate();
  saveFxCache(fresh); 
  return fresh;
}

function initExchangeCalculatorAuto() {
  const twdEl = document.getElementById("inputTWD");
  const krwEl = document.getElementById("inputKRW");
  const rateText = document.getElementById("fxRateText");
  const updatedText = document.getElementById("fxUpdatedText");
  const refreshBtn = document.getElementById("fxRefreshBtn");
  if (!twdEl || !krwEl || !rateText || !updatedText) return;

  let syncing = false; let rate = NaN; 

  function updateFromTWD() {
    if (syncing) return; syncing = true;
    const twd = fxParse(twdEl.value);
    if (!isFinite(twd) || !isFinite(rate)) { krwEl.value = ""; syncing = false; return; }
    krwEl.value = fxFmt(twd * rate); syncing = false;
  }
  function updateFromKRW() {
    if (syncing) return; syncing = true;
    const krw = fxParse(krwEl.value);
    if (!isFinite(krw) || !isFinite(rate) || rate === 0) { twdEl.value = ""; syncing = false; return; }
    twdEl.value = fxFmt(krw / rate); syncing = false;
  }

  twdEl.addEventListener("input", updateFromTWD);
  krwEl.addEventListener("input", updateFromKRW); // ì˜¤íƒ€ ìˆ˜ì •: krwaddEventListener -> krwEl.addEventListener

  async function renderRate(force = false) {
    rateText.textContent = "ê°€ì ¸ì˜¤ëŠ” ì¤‘â€¦";
    try {
      const fx = await getFxRate({ force });
      rate = Number(fx.rate);
      rateText.textContent = fxFmt(rate);
      updatedText.textContent = fx.updatedUtc || "-";
      const hasT = String(twdEl.value).trim() !== "";
      const hasK = String(krwEl.value).trim() !== "";
      if (hasT) updateFromTWD(); else if (hasK) updateFromKRW();
    } catch (e) {
      console.error(e); rateText.textContent = "ì‹¤íŒ¨"; updatedText.textContent = "-"; alert("í™˜ìœ¨ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
    }
  }
  
  if (refreshBtn) refreshBtn.addEventListener("click", () => renderRate(true));
  renderRate(false);
}
</script>

</body>
</html>
